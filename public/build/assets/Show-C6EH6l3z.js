import{a as N,r as m,b as u,d as c,o as v,e as s,u as b,g as F,w as o,i as e,t as l,H as A,j as _,h as T,F as V,k as j,Q as h,l as B}from"./app-8P1lhKkM.js";import{A as D}from"./AdminLayout-ImNpDzMH.js";/* empty css                                                                    */import"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"text-h6"},R={class:"text-caption"},U={class:"mt-2"},$={class:"d-flex justify-space-between align-center mb-4"},E={class:"d-flex",style:{gap:"8px"}},K={style:{"max-width":"300px","white-space":"pre-wrap"}},P={key:0},Q={class:"mt-4 d-flex justify-end"},O={__name:"Show",setup(z){const g=N().props.value,n=m(g.campaign),d=m(g.targets),i=m(g.filters||{q:"",status:""});m(d.value.current_page||1);function y(){h.get(route("broadcast.report.show",n.value.id),{q:i.value.q,status:i.value.status},{preserveState:!0})}async function w(f){var a,p;try{await B.post(`/broadcast/targets/${f}/retry`),alert("Retry requested"),h.reload()}catch(r){console.error(r),alert("Retry failed: "+(((p=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:p.message)??r.message))}}return(f,a)=>{const p=u("v-card"),r=u("v-text-field"),S=u("v-select"),x=u("v-btn"),k=u("v-chip"),C=u("v-table"),q=u("v-pagination");return v(),c(V,null,[s(b(F),{title:`Campaign - ${n.value.name}`},null,8,["title"]),s(D,null,{title:o(()=>a[4]||(a[4]=[_("Campaign Detail")])),default:o(()=>[s(p,{class:"pa-4 mb-4"},{default:o(()=>{var t;return[e("h3",L,l(n.value.name),1),e("div",R,"Template: "+l(((t=n.value.template)==null?void 0:t.name)||"-"),1),e("div",U,"Status: "+l(n.value.status)+" | Sent: "+l(n.value.sent_count)+" | Failed: "+l(n.value.failed_count),1)]}),_:1}),s(p,{class:"pa-4"},{default:o(()=>[e("div",$,[a[6]||(a[6]=e("div",null,[e("h4",{class:"text-h6"},"Targets"),e("div",{class:"text-caption"},"Per-target delivery log")],-1)),e("div",E,[s(r,{modelValue:i.value.q,"onUpdate:modelValue":a[0]||(a[0]=t=>i.value.q=t),dense:"",placeholder:"Search phone / name / error",onKeyup:A(y,["enter"])},null,8,["modelValue"]),s(S,{dense:"",modelValue:i.value.status,"onUpdate:modelValue":a[1]||(a[1]=t=>i.value.status=t),items:["pending","sent","failed"],clearable:"",placeholder:"Status"},null,8,["modelValue"]),s(x,{onClick:y},{default:o(()=>a[5]||(a[5]=[_("Filter")])),_:1,__:[5]})])]),s(C,{dense:""},{default:o(()=>[a[9]||(a[9]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Phone"),e("th",null,"Name"),e("th",null,"Status"),e("th",null,"Error"),e("th",null,"Sent At"),e("th",null,"Attempts"),e("th")])],-1)),e("tbody",null,[(v(!0),c(V,null,j(d.value.data,t=>(v(),c("tr",{key:t.id},[e("td",null,l(t.id),1),e("td",null,l(t.phone),1),e("td",null,l(t.name||"-"),1),e("td",null,[s(k,{color:t.status==="sent"?"green":t.status==="failed"?"red":"grey",size:"small"},{default:o(()=>[_(l(t.status),1)]),_:2},1032,["color"])]),e("td",K,l(t.error_message||"-"),1),e("td",null,l(t.sent_at?new Date(t.sent_at).toLocaleString():"-"),1),e("td",null,l(t.attempts??0),1),e("td",null,[s(x,{small:"",dense:"",onClick:H=>w(t.id),disabled:t.status==="sent"},{default:o(()=>a[7]||(a[7]=[_("Retry")])),_:2,__:[7]},1032,["onClick","disabled"])])]))),128)),d.value.data.length===0?(v(),c("tr",P,a[8]||(a[8]=[e("td",{colspan:"8",class:"text-center"},"No targets found.",-1)]))):T("",!0)])]),_:1,__:[9]}),e("div",Q,[s(q,{length:d.value.last_page,modelValue:d.value.current_page,"onUpdate:modelValue":[a[2]||(a[2]=t=>d.value.current_page=t),a[3]||(a[3]=t=>b(h).get(f.route("broadcast.report.show",n.value.id),{page:t},{preserveState:!0}))]},null,8,["length","modelValue"])])]),_:1})]),_:1})],64)}}};export{O as default};
