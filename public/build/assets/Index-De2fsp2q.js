import{A as J}from"./AdminLayout-B9id1OaC.js";import{G as K,r,m as O,c as F,b as o,d as N,o as V,e as a,u as Q,g as X,w as s,h as n,i as u,F as I,j as Y,k as Z,D as ee,t as f,f as ae,l as A}from"./app-CsZa9FYx.js";import te from"./Room-BilnQn1H.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"chat-flex"},ne={class:"chat-sidebar"},oe={class:"chat-list"},ie={class:"sidebar-search"},ue={class:"chat-scroll"},de={class:"chat-room"},re={class:"chat-window"},ce={key:0,class:"chat-header"},ve={class:"header-left"},me={class:"header-name"},_e={class:"header-phone"},pe={class:"chat-body"},fe={class:"chat-input"},he={__name:"Index",setup(ge){const _=K(),p=r([]),h=r(""),d=r(null),c=r(""),b=r(null),w=r(null),g=r(!1),k=r(!1),i=r({name:"",phone:"",message:""});async function U(){const l=await A.get("/chat/sessions");p.value=l.data,!d.value&&p.value.length&&(d.value=p.value[0].session_id)}O(U);const C=F(()=>p.value.find(l=>l.session_id===d.value)),R=F(()=>h.value?p.value.filter(l=>(l.customer_name??"").toLowerCase().includes(h.value.toLowerCase())||(l.phone??"").includes(h.value)):p.value);function T(l){d.value=l}async function L(){var v,y;if(!d.value)return;if(!c.value&&!b.value){_.warning("Pesan atau file harus diisi");return}const l=new FormData;l.append("message",c.value||""),b.value&&l.append("media",b.value);const e=c.value;c.value="",b.value=null,w.value&&(w.value.value="");try{await A.post(`/chat/sessions/${d.value}/messages`,l),_.success("Pesan berhasil dikirim")}catch(m){_.error(((y=(v=m.response)==null?void 0:v.data)==null?void 0:y.message)||"Gagal mengirim pesan"),c.value=e}}function B(){i.value={name:"",phone:"",message:""},g.value=!0}async function M(){var l;if(!i.value.phone){_.error("Nomor WhatsApp wajib diisi");return}k.value=!0;try{const e=await A.post("/chat/sessions/outbound",{name:i.value.name||i.value.phone,phone:i.value.phone,message:i.value.message||"",create_ticket:!1});if(!((l=e.data)!=null&&l.session_id))throw new Error("Invalid response");g.value=!1,await U(),d.value=e.data.session_id,_.success("Chat berhasil dibuat")}catch{_.error("Gagal membuat chat baru")}finally{k.value=!1}}return(l,e)=>{const v=o("v-text-field"),y=o("v-icon"),m=o("v-btn"),D=o("v-avatar"),P=o("v-list-item-title"),$=o("v-list-item-subtitle"),j=o("v-list-item"),E=o("v-list"),G=o("v-card-title"),S=o("v-textarea"),q=o("v-card-text"),W=o("v-card-actions"),z=o("v-card"),H=o("v-dialog");return V(),N(I,null,[a(Q(X),{title:"Chat"}),a(J,null,{title:s(()=>e[8]||(e[8]=[u("Chat")])),default:s(()=>[n("div",le,[n("aside",ne,[n("div",oe,[e[10]||(e[10]=n("div",{class:"chat-sidebar-title"},"DAFTAR CHAT",-1)),n("div",ie,[a(v,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:"Search chat","prepend-inner-icon":"mdi-magnify",variant:"solo",density:"compact","hide-details":"",class:"search"},null,8,["modelValue"]),a(m,{icon:"",class:"btn-primary",onClick:B},{default:s(()=>[a(y,null,{default:s(()=>e[9]||(e[9]=[u("mdi-plus")])),_:1,__:[9]})]),_:1})]),n("div",ue,[a(E,{density:"compact"},{default:s(()=>[(V(!0),N(I,null,Y(R.value,t=>(V(),Z(j,{key:t.session_id,onClick:x=>T(t.session_id),class:ee({active:t.session_id===d.value})},{prepend:s(()=>[a(D,{class:"avatar"},{default:s(()=>[u(f((t.customer_name??"U")[0]),1)]),_:2},1024)]),default:s(()=>[a(P,{class:"list-title"},{default:s(()=>[u(f(t.customer_name??t.phone),1)]),_:2},1024),a($,{class:"list-subtitle"},{default:s(()=>[u(f(t.last_message||"..."),1)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})])])]),n("section",de,[n("div",re,[C.value?(V(),N("div",ce,[n("div",ve,[a(D,{class:"avatar"},{default:s(()=>[u(f((C.value.customer_name??"U")[0]),1)]),_:1}),n("div",null,[n("div",me,f(C.value.customer_name??C.value.phone),1),n("div",_e,f(C.value.phone),1)])])])):ae("",!0),n("div",pe,[a(te,{"room-id":d.value},null,8,["room-id"])]),n("div",fe,[n("input",{type:"file",ref_key:"filePicker",ref:w,hidden:""},null,512),a(m,{icon:"",onClick:e[1]||(e[1]=t=>{var x;return(x=w.value)==null?void 0:x.click()})},{default:s(()=>[a(y,null,{default:s(()=>e[11]||(e[11]=[u("mdi-paperclip")])),_:1,__:[11]})]),_:1}),a(v,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value=t),placeholder:"Type a message...",variant:"solo",density:"compact","hide-details":"",class:"message-input"},null,8,["modelValue"]),a(m,{class:"btn-primary",onClick:L},{default:s(()=>e[12]||(e[12]=[u(" SEND ")])),_:1,__:[12]})])])])]),a(H,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=t=>g.value=t),"max-width":"420"},{default:s(()=>[a(z,{class:"dialog-dark"},{default:s(()=>[a(G,null,{default:s(()=>e[13]||(e[13]=[u("Add New Chat")])),_:1,__:[13]}),a(q,null,{default:s(()=>[a(v,{modelValue:i.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value.name=t),label:"Customer Name",variant:"outlined",density:"compact"},null,8,["modelValue"]),a(v,{modelValue:i.value.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.phone=t),label:"WhatsApp Number",variant:"outlined",density:"compact",required:""},null,8,["modelValue"]),a(S,{modelValue:i.value.message,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.message=t),label:"Initial Message",rows:"3",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),a(W,{class:"justify-end"},{default:s(()=>[a(m,{variant:"text",onClick:e[6]||(e[6]=t=>g.value=!1)},{default:s(()=>e[14]||(e[14]=[u("Cancel")])),_:1,__:[14]}),a(m,{class:"btn-primary",loading:k.value,onClick:M},{default:s(()=>e[15]||(e[15]=[u(" Create ")])),_:1,__:[15]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)}}},Ve=se(he,[["__scopeId","data-v-4168ec94"]]);export{Ve as default};
