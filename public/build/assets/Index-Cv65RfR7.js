import{A as O}from"./AdminLayout-B9id1OaC.js";import{G as z,r as p,m as D,q as H,b as i,d as w,o as c,e as l,u as U,g as j,w as s,h as t,i as a,t as v,k as C,f as q,F as h,j as G,l as J}from"./app-CsZa9FYx.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"test-container"},W={class:"status-info"},X={class:"d-flex gap-2"},Y={key:0,class:"text-center py-4 text-grey"},Z={__name:"Index",setup($){const d=z(),b=p("Hello from Test Broadcast!"),y=p(!1),u=p([]),r=p(!1),g=p("Not Connected");D(()=>{window.Echo?(g.value="Echo Available",window.Pusher&&(window.Pusher.logToConsole=!0),S()):(g.value="Echo Not Available",d.error("Echo is not initialized"))});function S(){const o=window.Echo.channel("test-push-message");o.subscribed(()=>{console.log("[TEST] âœ… Subscribed to test-push-message")}),o.error(e=>{console.error("[TEST] âŒ Subscription error:",e)}),o.listen(".TestMessageReceived",e=>{console.log("[TEST] Event received:",e),B(e)}),r.value=!0,g.value="Listening on test-push-message"}function B(o){u.value.find(n=>n.message===o.message&&n.timestamp===o.timestamp)||(u.value.unshift({message:o.message,timestamp:o.timestamp,receivedAt:new Date().toLocaleTimeString()}),d.success("Message received via broadcast!"))}function k(){window.Echo.leave("test-push-message"),r.value=!1,g.value="Echo Available (Not Listening)"}async function L(){var o,e;if(!b.value.trim()){d.warning("Please enter a message");return}y.value=!0;try{const n=await J.post("/test/broadcast/trigger",{message:b.value});d.success("Broadcast triggered successfully!")}catch(n){console.error("[TEST] Failed to trigger:",n),d.error(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to trigger broadcast")}finally{y.value=!1}}function M(){u.value=[],d.info("Messages cleared")}return H(()=>{r.value&&k()}),(o,e)=>{const n=i("v-card-title"),x=i("v-chip"),m=i("v-card-text"),_=i("v-card"),N=i("v-text-field"),E=i("v-icon"),T=i("v-btn"),A=i("v-list-item-title"),V=i("v-list-item-subtitle"),R=i("v-list-item"),I=i("v-list"),F=i("v-divider");return c(),w(h,null,[l(U(j),{title:"Test Broadcast"}),l(O,null,{title:s(()=>e[1]||(e[1]=[a("Test Broadcast & Subscribe")])),default:s(()=>[t("div",Q,[l(_,{class:"mb-4"},{default:s(()=>[l(n,null,{default:s(()=>e[2]||(e[2]=[a("Connection Status")])),_:1,__:[2]}),l(m,null,{default:s(()=>[t("div",W,[l(x,{color:r.value?"success":"warning",variant:"flat"},{default:s(()=>[a(v(g.value),1)]),_:1},8,["color"]),e[3]||(e[3]=t("div",{class:"mt-2"},[t("small",null,[t("strong",null,"Channel:"),a(" test-push-message")]),t("br"),t("small",null,[t("strong",null,"Event:"),a(" TestMessageReceived")])],-1))])]),_:1})]),_:1}),l(_,{class:"mb-4"},{default:s(()=>[l(n,null,{default:s(()=>e[4]||(e[4]=[a("1. Trigger Broadcast")])),_:1,__:[4]}),l(m,null,{default:s(()=>[e[7]||(e[7]=t("p",{class:"mb-3"},"Send a test message to broadcast:",-1)),l(N,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=f=>b.value=f),label:"Test Message",variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"]),l(T,{color:"primary",class:"mt-3",loading:y.value,onClick:L},{default:s(()=>[l(E,{left:""},{default:s(()=>e[5]||(e[5]=[a("mdi-send")])),_:1,__:[5]}),e[6]||(e[6]=a(" Trigger Broadcast "))]),_:1,__:[6]},8,["loading"])]),_:1,__:[7]})]),_:1}),l(_,{class:"mb-4"},{default:s(()=>[l(n,null,{default:s(()=>[e[8]||(e[8]=a(" 2. Listener Status ")),l(x,{color:r.value?"success":"grey",size:"small",class:"ml-2"},{default:s(()=>[a(v(r.value?"Active":"Inactive"),1)]),_:1},8,["color"])]),_:1,__:[8]}),l(m,null,{default:s(()=>[t("div",X,[l(T,{color:"success",variant:"outlined",disabled:r.value,onClick:S},{default:s(()=>e[9]||(e[9]=[a(" Start Listening ")])),_:1,__:[9]},8,["disabled"]),l(T,{color:"error",variant:"outlined",disabled:!r.value,onClick:k},{default:s(()=>e[10]||(e[10]=[a(" Stop Listening ")])),_:1,__:[10]},8,["disabled"])])]),_:1})]),_:1}),l(_,null,{default:s(()=>[l(n,{class:"d-flex justify-space-between align-center"},{default:s(()=>[t("span",null,"3. Received Messages ("+v(u.value.length)+")",1),u.value.length?(c(),C(T,{key:0,size:"small",color:"error",variant:"text",onClick:M},{default:s(()=>e[11]||(e[11]=[a(" Clear ")])),_:1,__:[11]})):q("",!0)]),_:1}),l(m,null,{default:s(()=>[u.value.length?(c(),C(I,{key:1,density:"compact"},{default:s(()=>[(c(!0),w(h,null,G(u.value,(f,P)=>(c(),C(R,{key:P,class:"message-item"},{prepend:s(()=>[l(E,{color:"success"},{default:s(()=>e[12]||(e[12]=[a("mdi-check-circle")])),_:1,__:[12]})]),default:s(()=>[l(A,null,{default:s(()=>[a(v(f.message),1)]),_:2},1024),l(V,null,{default:s(()=>[a(" Sent: "+v(f.timestamp)+" | Received: "+v(f.receivedAt),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(c(),w("div",Y," No messages received yet. Trigger a broadcast to test. "))]),_:1})]),_:1}),l(_,{class:"mt-4",color:"blue-grey-darken-4"},{default:s(()=>[l(n,null,{default:s(()=>e[13]||(e[13]=[a("ðŸ“‹ How to Test")])),_:1,__:[13]}),l(m,null,{default:s(()=>[e[14]||(e[14]=t("ol",{class:"test-instructions"},[t("li",null,'Check that "Connection Status" shows "Listening on test-push-message"'),t("li",null,'Enter a message and click "Trigger Broadcast"'),t("li",null,[a("If broadcast works, you should see: "),t("ul",null,[t("li",null,"Success toast notification"),t("li",null,[a("Console log: "),t("code",null,"[TEST] Event received:")]),t("li",null,'Message appears in "Received Messages" section')])]),t("li",null,[t("strong",null,"Open browser console (F12)"),a(" to see detailed logs")])],-1)),l(F,{class:"my-3"}),e[15]||(e[15]=t("p",{class:"mb-1"},[t("strong",null,"Troubleshooting:")],-1)),e[16]||(e[16]=t("ul",{class:"test-instructions"},[t("li",null,"Check .env has correct PUSHER credentials"),t("li",null,"Verify BROADCAST_CONNECTION=pusher"),t("li",null,[a("Check Laravel logs: "),t("code",null,"storage/logs/laravel.log")]),t("li",null,"Check Pusher dashboard for events")],-1))]),_:1,__:[14,15,16]})]),_:1})])]),_:1})],64)}}},le=K(Z,[["__scopeId","data-v-42cda38c"]]);export{le as default};
