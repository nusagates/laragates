import{G,r as c,x as K,d as e,o as l,f as d,h as t,i as v,t as i,D as M,F as C,I as w,K as j,j as V,J as N,H as E,l as f}from"./app-CsZa9FYx.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"contact-detail"},H={key:0,class:"empty"},J={key:1,class:"detail-wrapper"},O={key:0,class:"status-banner danger"},q={key:1,class:"status-banner vip"},Q={class:"header"},R={key:0,class:"badge vip"},W={class:"phone"},X={key:2,class:"contact-status-bar"},Y={class:"activity"},Z={class:"messages"},tt={class:"flags"},st={key:3,class:"contact-status-bar muted"},at={class:"stats"},et={key:4,class:"alert"},lt={class:"toggles"},nt=["checked"],ot={class:"section"},it={class:"tags"},ut=["onClick"],ct={class:"section"},dt={class:"section timeline-box"},rt={key:0,class:"muted"},vt={key:1,class:"muted"},pt={class:"timeline-scroll"},mt={class:"event"},gt={class:"meta"},_t={class:"actions"},ft=["href"],kt={key:2,class:"confirm"},yt={class:"confirm-box"},bt={class:"confirm-actions"},ht={__name:"ContactDetail",props:{contactId:Number},setup(D){const r=D,k=G(),a=c(null),y=c([]),b=c(!1),h=c(!1),u=c(null),g=c(!1),m=c(""),_=c(!1);async function $(){if(!r.contactId){a.value=null;return}b.value=!0;try{const n=await f.get(`/contacts/${r.contactId}`);a.value=n.data}catch{k.error("Gagal memuat contact")}finally{b.value=!1}}async function I(){if(r.contactId){h.value=!0;try{const n=await f.get(`/contacts/${r.contactId}/timeline`);y.value=n.data}finally{h.value=!1}}}async function L(){if(r.contactId){g.value=!0;try{const n=await f.get(`/customers/${r.contactId}/summary`);u.value=n.data}catch{u.value=null}finally{g.value=!1}}}K(()=>r.contactId,async()=>{await $(),await I(),await L()},{immediate:!0});async function p(){try{await f.put(`/contacts/${a.value.id}`,{notes:a.value.notes,is_vip:a.value.is_vip,is_blacklisted:a.value.is_blacklisted,tags:a.value.tags}),k.success("Contact updated"),I()}catch{k.error("Gagal update contact")}}function A(){if(!m.value)return;const n=m.value.toLowerCase();a.value.tags||(a.value.tags=[]),a.value.tags.includes(n)||(a.value.tags.push(n),p()),m.value=""}function S(n){a.value.tags=a.value.tags.filter(s=>s!==n),p()}function P(){if(!a.value.is_blacklisted){_.value=!0;return}a.value.is_blacklisted=!1,p()}function U(){a.value.is_blacklisted=!0,_.value=!1,p()}function x(n){return n?new Date(n).toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}return(n,s)=>{var T;return l(),e("div",z,[!a.value&&!b.value?(l(),e("div",H," Select a contact ")):a.value?(l(),e("div",J,[a.value.is_blacklisted?(l(),e("div",O,s[4]||(s[4]=[v(" ðŸš« "),t("b",null,"Blacklist Contact",-1),t("span",null,"Agent tidak dapat mengirim pesan ke nomor ini",-1)]))):a.value.is_vip?(l(),e("div",q,s[5]||(s[5]=[v(" â­ "),t("b",null,"VIP Customer",-1),t("span",null," | Prioritaskan respon dan layanan",-1)]))):d("",!0),t("div",Q,[t("div",null,[t("h2",null,[v(i(a.value.name||a.value.phone)+" ",1),a.value.is_vip?(l(),e("span",R,"VIP")):d("",!0)]),t("p",W,i(a.value.phone),1)])]),u.value&&!g.value?(l(),e("div",X,[t("span",{class:M(["status-pill",u.value.status])},[s[6]||(s[6]=t("span",{class:"dot-indicator"},null,-1)),v(" "+i(u.value.status.toUpperCase()),1)],2),s[8]||(s[8]=t("span",{class:"dot"},"â€¢",-1)),t("span",Y,i(((T=u.value.last_activity)==null?void 0:T.text)??"No recent activity"),1),s[9]||(s[9]=t("span",{class:"dot"},"â€¢",-1)),t("span",Z,i(u.value.counters.messages_today)+" msg today ",1),u.value.flags.length?(l(),e(C,{key:0},[s[7]||(s[7]=t("span",{class:"dot"},"â€¢",-1)),t("span",tt,i(u.value.flags.join(", ")),1)],64)):d("",!0)])):g.value?(l(),e("div",st," Loading contact status... ")):d("",!0),t("div",at,[t("div",null,[t("b",null,i(a.value.total_chats),1),s[10]||(s[10]=t("span",null," Chats |",-1))]),t("div",null,[t("b",null,i(a.value.total_messages),1),s[11]||(s[11]=t("span",null," Messages |",-1))]),t("div",null,[t("b",null,i(x(a.value.last_contacted_at)),1),s[12]||(s[12]=t("span",null," Last Contact",-1))])]),a.value.is_blacklisted?(l(),e("div",et," âš ï¸ Contact ini diblacklist. Agent tidak dapat mengirim pesan. ")):d("",!0),t("div",lt,[t("label",null,[w(t("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=o=>a.value.is_vip=o),onChange:p},null,544),[[j,a.value.is_vip]]),s[13]||(s[13]=v(" VIP Customer "))]),t("label",null,[t("input",{type:"checkbox",checked:a.value.is_blacklisted,onChange:P},null,40,nt),s[14]||(s[14]=v(" Blacklist Contact "))])]),t("div",ot,[s[15]||(s[15]=t("h4",null,"Tags",-1)),t("div",it,[(l(!0),e(C,null,V(a.value.tags||[],o=>(l(),e("span",{key:o,class:"tag"},[v(i(o)+" ",1),t("button",{onClick:B=>S(o)},"Ã—",8,ut)]))),128))]),w(t("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>m.value=o),onKeyup:E(A,["enter"]),placeholder:"Type tag and press Enter"},null,544),[[N,m.value]])]),t("div",ct,[s[16]||(s[16]=t("h4",null,"Internal Notes",-1)),w(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=o=>a.value.notes=o),rows:"4",placeholder:"Notes internal untuk agent / supervisor...",onBlur:p},null,544),[[N,a.value.notes]])]),t("div",dt,[s[18]||(s[18]=t("h4",null,"Activity Timeline",-1)),h.value?(l(),e("div",rt,"Loading activity...")):y.value.length?d("",!0):(l(),e("div",vt,"No activity")),t("div",pt,[(l(!0),e(C,null,V(y.value,(o,B)=>(l(),e("div",{key:B,class:"timeline-item"},[s[17]||(s[17]=t("div",{class:"dot"},null,-1)),t("div",null,[t("div",mt,i(o.event.replaceAll("_"," ")),1),t("div",gt,i(o.actor)+" â€¢ "+i(x(o.time)),1)])]))),128))])]),t("div",_t,[t("a",{href:`/chat?phone=${a.value.phone}`,class:"btn"}," Open Chat ",8,ft)])])):d("",!0),_.value?(l(),e("div",kt,[t("div",yt,[s[19]||(s[19]=t("h4",null,"Blacklist contact?",-1)),s[20]||(s[20]=t("p",null,"Agent tidak akan bisa mengirim pesan.",-1)),t("div",bt,[t("button",{class:"btn ghost",onClick:s[3]||(s[3]=o=>_.value=!1)},"Cancel"),t("button",{class:"btn danger",onClick:U},"Blacklist")])])])):d("",!0)])}}},It=F(ht,[["__scopeId","data-v-04570937"]]);export{It as default};
