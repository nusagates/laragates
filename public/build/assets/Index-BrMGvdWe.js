import{A as P}from"./AdminLayout-BSfQMc_f.js";import{a as Q,c as g,r as x,b as d,d as u,o as r,e as a,u as B,g as R,w as n,f as l,i as _,l as W,h as p,Q as T,t as i,F as U,j as G,m as H}from"./app-XQ9sXrzo.js";const I={key:0,class:"mt-2 mb-4"},K={class:"d-flex justify-end mt-6 ga-2"},M={key:0},$={class:"text-body-2 mt-2"},q={key:1,class:"text-body-2 text-grey-darken-1"},z={key:0},J={class:"text-body-2"},X={class:"text-caption text-grey-darken-1"},Y={class:"text-body-2"},Z={key:0},ee={class:"text-body-2"},se={__name:"Index",setup(te){const V=Q(),k=g(()=>V.props.templates||[]),C=g(()=>V.props.history||[]),t=x({name:"",template_id:null,audience_type:"csv",schedule_type:"now",send_at:null,csv_file:null}),c=x(!1),f=x({}),y=g(()=>k.value.find(s=>s.id===t.value.template_id)||null);function N(s){const e=s.target.files[0];t.value.csv_file=e??null}async function D(){c.value=!0,f.value={};try{const s=new FormData;s.append("name",t.value.name),s.append("template_id",t.value.template_id||""),s.append("audience_type",t.value.audience_type),s.append("schedule_type",t.value.schedule_type),t.value.schedule_type==="later"&&t.value.send_at&&s.append("send_at",t.value.send_at),t.value.audience_type==="csv"&&t.value.csv_file&&s.append("csv_file",t.value.csv_file),await H.post(route("broadcast.store"),s),T.visit(route("broadcast"),{preserveScroll:!0})}catch(s){s.response&&s.response.status===422?f.value=s.response.data.errors||{}:(console.error(s),alert("Gagal membuat broadcast. Cek console."))}finally{c.value=!1}}function m(s){var e;return((e=f.value[s])==null?void 0:e[0])||""}return(s,e)=>{const w=d("v-text-field"),F=d("v-select"),v=d("v-radio"),S=d("v-radio-group"),L=d("v-file-input"),h=d("v-btn"),b=d("v-card"),A=d("v-col"),O=d("v-sheet"),j=d("v-table"),E=d("v-row");return r(),u(U,null,[a(B(R),{title:"Broadcast"}),a(P,null,{title:n(()=>e[6]||(e[6]=[p("Broadcast")])),default:n(()=>[a(E,null,{default:n(()=>[a(A,{cols:"12",md:"8"},{default:n(()=>[a(b,{elevation:"2",class:"pa-4"},{default:n(()=>[e[10]||(e[10]=l("h3",{class:"text-h6 font-weight-bold mb-1"},"Create Broadcast Campaign",-1)),e[11]||(e[11]=l("p",{class:"text-body-2 text-grey-darken-1 mb-4"}," Kirim pesan template WhatsApp ke banyak pelanggan sekaligus. ",-1)),a(w,{modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.name=o),label:"Campaign Name",density:"comfortable","error-messages":m("name"),class:"mb-4"},null,8,["modelValue","error-messages"]),a(F,{modelValue:t.value.template_id,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.template_id=o),items:k.value,"item-title":"name","item-value":"id",label:"Template Message",density:"comfortable","error-messages":m("template_id"),class:"mb-4"},null,8,["modelValue","items","error-messages"]),e[12]||(e[12]=l("h4",{class:"text-subtitle-2 mb-2"},"Audience",-1)),a(S,{modelValue:t.value.audience_type,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.audience_type=o),inline:"","error-messages":m("audience_type")},{default:n(()=>[a(v,{label:"All Customers (TODO)",value:"all"}),a(v,{label:"Upload CSV",value:"csv"})]),_:1},8,["modelValue","error-messages"]),t.value.audience_type==="csv"?(r(),u("div",I,[e[7]||(e[7]=l("p",{class:"text-body-2 mb-1"},[p(" Upload file CSV berisi daftar nomor WhatsApp (1 kolom, tanpa header). Contoh: "),l("code",null,"6281234567890")],-1)),a(L,{accept:".csv,text/csv",label:"CSV File",density:"comfortable","prepend-icon":"mdi-file-delimited",onChange:N,"error-messages":m("csv_file")},null,8,["error-messages"])])):_("",!0),e[13]||(e[13]=l("h4",{class:"text-subtitle-2 mt-4 mb-2"},"Schedule",-1)),a(S,{modelValue:t.value.schedule_type,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.schedule_type=o),inline:"","error-messages":m("schedule_type")},{default:n(()=>[a(v,{label:"Send Now",value:"now"}),a(v,{label:"Schedule Later",value:"later"})]),_:1},8,["modelValue","error-messages"]),t.value.schedule_type==="later"?(r(),W(w,{key:1,modelValue:t.value.send_at,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.send_at=o),type:"datetime-local",label:"Send At",density:"comfortable",class:"mt-2","error-messages":m("send_at")},null,8,["modelValue","error-messages"])):_("",!0),l("div",K,[a(h,{variant:"text",onClick:e[5]||(e[5]=o=>B(T).visit(s.route("broadcast")))},{default:n(()=>e[8]||(e[8]=[p(" Cancel ")])),_:1,__:[8]}),a(h,{color:"primary",loading:c.value,onClick:D},{default:n(()=>e[9]||(e[9]=[p(" START BROADCAST ")])),_:1,__:[9]},8,["loading"])])]),_:1,__:[10,11,12,13]})]),_:1}),a(A,{cols:"12",md:"4"},{default:n(()=>[a(b,{elevation:"2",class:"pa-4 mb-4"},{default:n(()=>[e[14]||(e[14]=l("h4",{class:"text-subtitle-1 font-weight-bold mb-2"}," Selected Template Preview ",-1)),a(O,{class:"pa-3 mt-2",color:"grey-lighten-4",style:{"border-radius":"12px"}},{default:n(()=>[y.value?(r(),u("div",M,[l("strong",null,i(y.value.name),1),l("p",$,i(y.value.body||"Template body preview."),1)])):(r(),u("div",q," Pilih template untuk melihat preview. "))]),_:1})]),_:1,__:[14]}),a(b,{elevation:"2",class:"pa-4"},{default:n(()=>[e[17]||(e[17]=l("h4",{class:"text-subtitle-1 font-weight-bold mb-2"}," History ",-1)),a(j,{density:"compact"},{default:n(()=>[e[16]||(e[16]=l("thead",null,[l("tr",null,[l("th",null,"Campaign"),l("th",null,"Sent"),l("th",null,"Date")])],-1)),l("tbody",null,[C.value.length?_("",!0):(r(),u("tr",z,e[15]||(e[15]=[l("td",{colspan:"3",class:"text-center text-body-2 py-4"}," Belum ada riwayat broadcast. ",-1)]))),(r(!0),u(U,null,G(C.value,o=>(r(),u("tr",{key:o.id},[l("td",null,[l("div",J,i(o.name),1),l("div",X,i(o.template),1)]),l("td",Y,[p(i(o.sent)+" ",1),o.failed?(r(),u("span",Z,"/ "+i(o.failed)+" failed",1)):_("",!0)]),l("td",ee,i(o.date),1)]))),128))])]),_:1,__:[16]})]),_:1,__:[17]})]),_:1})]),_:1})]),_:1})],64)}}};export{se as default};
