import{_ as O,A as Q}from"./AdminLayout-BSfQMc_f.js";import{r as d,n as X,c as Y,b as n,d as j,o as p,e as t,u as Z,g as ee,w as a,f as i,h as r,l as w,i as E,F,j as te,p as ae,t as g,m as C}from"./app-XQ9sXrzo.js";import le from"./Room-D7IeB-WC.js";const oe={class:"chat-flex"},se={class:"chat-sidebar"},ne={class:"d-flex align-center mb-3"},ie={class:"white--text"},ue={class:"text-body-2 text-grey"},re={class:"chat-room"},de={class:"chat-body"},ce={class:"chat-input"},me={class:"d-flex justify-end gap-2"},_e={__name:"Index",setup(ve){const c=d([]),f=d(""),u=d(null),m=d(""),_=d(!1),h=d(!1),s=d({name:"",phone:"",message:"",create_ticket:!1});async function V(){const l=await C.get("/api/chats");c.value=l.data,!u.value&&c.value.length&&(u.value=c.value[0].session_id)}X(()=>{V()});const k=Y(()=>f.value?c.value.filter(l=>l.customer_name.toLowerCase().includes(f.value.toLowerCase())):c.value);function I(l){u.value=l}async function M(){if(!m.value.trim()||!u.value)return;const l=m.value;m.value="";try{const e=await C.post(`/api/chats/${u.value}/send`,{message:l});window.dispatchEvent(new CustomEvent("agent-message-sent",{detail:e.data}))}catch(e){console.log(e),alert("Gagal mengirim pesan!")}}function N(){let l=s.value.phone||"";if(l=l.trim(),!l){s.value.phone="";return}if(l=l.replace(/[^0-9+]/g,""),l.startsWith("+")){s.value.phone=l;return}if(l.startsWith("0")){s.value.phone="+62"+l.slice(1);return}if(l.startsWith("62")){s.value.phone="+"+l;return}s.value.phone="+"+l}function S(){s.value={name:"",phone:"",message:"",create_ticket:!1},_.value=!0}async function $(){var l;if(!s.value.phone||!s.value.message){alert("Phone dan message wajib diisi.");return}h.value=!0;try{N();const e=await C.post("/api/chats/outbound",{name:s.value.name||null,phone:s.value.phone,message:s.value.message,create_ticket:s.value.create_ticket});_.value=!1,await V(),(l=e.data)!=null&&l.session_id&&(u.value=e.data.session_id)}catch(e){console.error(e),alert("Gagal membuat chat baru.")}finally{h.value=!1}}return(l,e)=>{const b=n("v-text-field"),U=n("v-icon"),v=n("v-btn"),A=n("v-divider"),D=n("v-avatar"),R=n("v-list-item-avatar"),B=n("v-list-item-title"),T=n("v-list-item-subtitle"),G=n("v-list-item-content"),P=n("v-badge"),q=n("v-list-item-action"),L=n("v-list-item"),z=n("v-list"),x=n("v-card"),y=n("v-col"),W=n("v-textarea"),K=n("v-row"),H=n("v-checkbox"),J=n("v-dialog");return p(),j(F,null,[t(Z(ee),{title:"Chat"}),t(Q,null,{title:a(()=>e[8]||(e[8]=[r("Chat")])),default:a(()=>[i("div",oe,[i("div",se,[t(x,{class:"pa-4 chat-list",elevation:"2"},{default:a(()=>[i("div",ne,[t(b,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),placeholder:"Search customer or phone...",density:"comfortable",rounded:"","hide-details":"","prepend-inner-icon":"mdi-magnify",class:"flex-grow-1 mr-2"},null,8,["modelValue"]),t(v,{color:"primary",icon:"",title:"New Chat",onClick:S},{default:a(()=>[t(U,null,{default:a(()=>e[9]||(e[9]=[r("mdi-message-plus")])),_:1,__:[9]})]),_:1})]),t(A),t(z,{"two-line":"",density:"comfortable"},{default:a(()=>[(p(!0),j(F,null,te(k.value,o=>(p(),w(L,{key:o.session_id,onClick:pe=>I(o.session_id),class:ae({"bg-highlight":o.session_id===u.value}),style:{cursor:"pointer"}},{default:a(()=>[t(R,null,{default:a(()=>[t(D,{color:"blue"},{default:a(()=>[i("span",ie,g(o.customer_name.charAt(0)),1)]),_:2},1024)]),_:2},1024),t(G,null,{default:a(()=>[t(B,{class:"d-flex justify-space-between align-center"},{default:a(()=>[i("span",null,g(o.customer_name),1),i("small",ue,g(o.time),1)]),_:2},1024),t(T,{class:"text-truncate text-body-2"},{default:a(()=>[r(g(o.last_message),1)]),_:2},1024)]),_:2},1024),t(q,null,{default:a(()=>[o.unread_count?(p(),w(P,{key:0,content:o.unread_count,color:"red"},null,8,["content"])):E("",!0)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128)),k.value.length?E("",!0):(p(),w(L,{key:0},{default:a(()=>[t(B,{class:"text-center text-grey"},{default:a(()=>e[10]||(e[10]=[r(" No chats ")])),_:1,__:[10]})]),_:1}))]),_:1})]),_:1})]),i("div",re,[t(x,{class:"chat-window",elevation:"2"},{default:a(()=>[i("div",de,[t(le,{"room-id":u.value},null,8,["room-id"])]),i("div",ce,[t(K,{align:"center",class:"no-gutters"},{default:a(()=>[t(y,{cols:"auto"},{default:a(()=>[t(v,{icon:""},{default:a(()=>[t(U,null,{default:a(()=>e[11]||(e[11]=[r("mdi-emoticon-outline")])),_:1,__:[11]})]),_:1})]),_:1}),t(y,null,{default:a(()=>[t(W,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o),placeholder:"Type a message",rows:"1","auto-grow":"",variant:"outlined",class:"me-2"},null,8,["modelValue"])]),_:1}),t(y,{cols:"auto"},{default:a(()=>[t(v,{color:"primary",onClick:M},{default:a(()=>e[12]||(e[12]=[r("SEND")])),_:1,__:[12]})]),_:1})]),_:1})])]),_:1})])]),t(J,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=o=>_.value=o),"max-width":"480"},{default:a(()=>[t(x,{class:"pa-4"},{default:a(()=>[e[15]||(e[15]=i("h3",{class:"text-h6 mb-3"},"New Chat",-1)),e[16]||(e[16]=i("p",{class:"text-body-2 text-grey-darken-1 mb-4"}," Kirim pesan WhatsApp pertama ke customer baru atau existing. ",-1)),t(b,{modelValue:s.value.name,"onUpdate:modelValue":e[2]||(e[2]=o=>s.value.name=o),label:"Customer Name (optional)",density:"comfortable",class:"mb-3"},null,8,["modelValue"]),t(b,{modelValue:s.value.phone,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.phone=o),label:"WhatsApp Number",density:"comfortable",placeholder:"0812xxxx / +62812xxxx",class:"mb-3",onBlur:N},null,8,["modelValue"]),t(W,{modelValue:s.value.message,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.message=o),label:"First Message",rows:"2","auto-grow":"",density:"comfortable",variant:"outlined",class:"mb-3"},null,8,["modelValue"]),t(H,{modelValue:s.value.create_ticket,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.create_ticket=o),label:"Create Ticket from this chat",density:"comfortable",class:"mb-2"},null,8,["modelValue"]),t(A,{class:"my-3"}),i("div",me,[t(v,{variant:"text",onClick:e[6]||(e[6]=o=>_.value=!1)},{default:a(()=>e[13]||(e[13]=[r(" Cancel ")])),_:1,__:[13]}),t(v,{color:"primary",loading:h.value,onClick:$},{default:a(()=>e[14]||(e[14]=[r(" Start Chat ")])),_:1,__:[14]},8,["loading"])])]),_:1,__:[15,16]})]),_:1},8,["modelValue"])]),_:1})],64)}}},be=O(_e,[["__scopeId","data-v-98c431d2"]]);export{be as default};
