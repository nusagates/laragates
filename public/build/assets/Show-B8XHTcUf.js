import{G as L,a as R,c as k,r as V,b as i,d as f,o as m,e as o,u as C,g as U,w as r,h as t,t as a,i as c,D as E,k as K,f as q,H as P,F as A,j as Q,Q as y,l as j}from"./app-CsZa9FYx.js";import{A as G}from"./AdminLayout-B9id1OaC.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const I={class:"d-flex align-center",style:{gap:"12px"}},M={class:"report-dark"},J={class:"header-card mb-6"},O={class:"summary-left"},W={class:"template-info"},X={class:"stats"},Y={class:"stat-box"},Z={class:"stat-box"},tt={class:"success"},et={class:"stat-box"},st={class:"danger"},at={class:"stat-box"},lt={class:"targets-header"},ot={class:"muted"},nt={class:"filters"},rt={class:"error-cell"},ut={class:"text-right"},it={key:0},dt={class:"pagination-wrapper"},ct={class:"pagination-info"},pt={__name:"Show",setup(vt){const S=L(),h=R(),l=k(()=>h.props.campaign),u=k(()=>h.props.targets),n=V(h.props.filters||{q:"",status:""}),v=V(!1),b=k(()=>{const p=l.value.total_targets||0,e=l.value.sent_count||0;return p===0?0:Math.round(e/p*100)});function _(){y.get(route("broadcast.report.show",l.value.id),{q:n.value.q,status:n.value.status},{preserveState:!0,preserveScroll:!0})}async function T(p){var e,d;if(!v.value)try{v.value=!0,await j.post(`/broadcast/targets/${p}/retry`),S.success("Target queued for retry"),y.reload({only:["targets"]})}catch(x){const g=((d=(e=x.response)==null?void 0:e.data)==null?void 0:d.message)||"Failed to retry target";S.error(g)}finally{v.value=!1}}function F(){y.visit(route("broadcast.reports"))}return(p,e)=>{const d=i("v-btn"),x=i("v-icon"),g=i("v-chip"),N=i("v-text-field"),z=i("v-select"),B=i("v-table"),D=i("v-pagination"),$=i("v-card");return m(),f(A,null,[o(C(U),{title:`Campaign - ${l.value.name}`},null,8,["title"]),o(G,null,{title:r(()=>[t("div",I,[o(d,{icon:"mdi-arrow-left",variant:"text",onClick:F}),e[5]||(e[5]=t("span",null,"Campaign Detail",-1))])]),default:r(()=>{var w;return[t("div",M,[t("div",J,[t("div",O,[t("h3",null,a(l.value.name),1),t("p",W,[o(x,{size:"small"},{default:r(()=>e[6]||(e[6]=[c("mdi-message-text")])),_:1,__:[6]}),c(" "+a(((w=l.value.template)==null?void 0:w.name)||"-"),1)]),o(g,{size:"small",color:l.value.status==="completed"?"green":l.value.status==="failed"?"red":"blue",class:"mt-2"},{default:r(()=>[c(a(l.value.status),1)]),_:1},8,["color"])]),t("div",X,[t("div",Y,[e[7]||(e[7]=t("span",null,"Total Targets",-1)),t("strong",null,a(l.value.total_targets||0),1)]),t("div",Z,[e[8]||(e[8]=t("span",null,"Sent",-1)),t("strong",tt,a(l.value.sent_count||0),1)]),t("div",et,[e[9]||(e[9]=t("span",null,"Failed",-1)),t("strong",st,a(l.value.failed_count||0),1)]),t("div",at,[e[10]||(e[10]=t("span",null,"Success Rate",-1)),t("strong",{class:E(b.value>=80?"success":b.value>=50?"warning":"danger")},a(b.value)+"% ",3)])])]),o($,{class:"card pa-4"},{default:r(()=>[t("div",lt,[t("div",null,[e[11]||(e[11]=t("h4",null,"Delivery Targets",-1)),t("p",ot,a(u.value.total||0)+" total records",1)]),t("div",nt,[o(N,{modelValue:n.value.q,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.q=s),placeholder:"Search phone / name / error","prepend-inner-icon":"mdi-magnify",density:"compact","hide-details":"",class:"filter-input",onKeyup:P(_,["enter"])},null,8,["modelValue"]),o(z,{modelValue:n.value.status,"onUpdate:modelValue":[e[1]||(e[1]=s=>n.value.status=s),_],items:[{title:"Pending",value:"pending"},{title:"Sent",value:"sent"},{title:"Failed",value:"failed"}],placeholder:"All Status",clearable:"",density:"compact","hide-details":"",class:"filter-select"},null,8,["modelValue"]),o(d,{color:"primary","prepend-icon":"mdi-filter",onClick:_},{default:r(()=>e[12]||(e[12]=[c(" Apply ")])),_:1,__:[12]}),n.value.q||n.value.status?(m(),K(d,{key:0,variant:"text",onClick:e[2]||(e[2]=s=>{n.value={q:"",status:""},_()})},{default:r(()=>e[13]||(e[13]=[c(" Clear ")])),_:1,__:[13]})):q("",!0)])]),o(B,null,{default:r(()=>[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Phone"),t("th",null,"Name"),t("th",null,"Status"),t("th",null,"Error"),t("th",null,"Sent At"),t("th",null,"Attempts"),t("th",{class:"text-right"},"Action")])],-1)),t("tbody",null,[(m(!0),f(A,null,Q(u.value.data,s=>(m(),f("tr",{key:s.id,class:"row-hover"},[t("td",null,a(s.id),1),t("td",null,a(s.phone),1),t("td",null,a(s.name||"-"),1),t("td",null,[o(g,{size:"small",color:s.status==="sent"?"green-darken-2":s.status==="failed"?"red-darken-2":"grey-darken-1"},{default:r(()=>[c(a(s.status),1)]),_:2},1032,["color"])]),t("td",rt,a(s.error_message||"-"),1),t("td",null,a(s.sent_at?new Date(s.sent_at).toLocaleString():"-"),1),t("td",null,a(s.attempts??0),1),t("td",ut,[o(d,{size:"small",variant:"tonal",color:"orange","prepend-icon":"mdi-refresh",onClick:mt=>T(s.id),disabled:s.status==="sent"||v.value,loading:v.value},{default:r(()=>e[14]||(e[14]=[c(" Retry ")])),_:2,__:[14]},1032,["onClick","disabled","loading"])])]))),128)),u.value.data.length===0?(m(),f("tr",it,e[15]||(e[15]=[t("td",{colspan:"8",class:"text-center muted pa-6"}," No targets found. ",-1)]))):q("",!0)])]),_:1,__:[16]}),t("div",dt,[t("div",ct," Showing "+a(u.value.from||0)+" to "+a(u.value.to||0)+" of "+a(u.value.total||0),1),o(D,{modelValue:u.value.current_page,"onUpdate:modelValue":[e[3]||(e[3]=s=>u.value.current_page=s),e[4]||(e[4]=s=>C(y).get(p.route("broadcast.report.show",l.value.id),{page:s,...n.value},{preserveState:!0,preserveScroll:!1}))],length:u.value.last_page,"total-visible":7},null,8,["modelValue","length"])])]),_:1})])]}),_:1})],64)}}},yt=H(pt,[["__scopeId","data-v-f30fa001"]]);export{yt as default};
