import{a as le,r as i,c as oe,m as ne,x as ue,b as d,d as p,o as _,e as s,u as ie,g as de,w as u,h as l,H as ce,i as c,F as S,j as K,D as j,t as m,f as O,l as h,Q as $}from"./app-CsZa9FYx.js";import{A as re}from"./AdminLayout-B9id1OaC.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"tickets-root"},pe={class:"tickets-sidebar"},_e={class:"sidebar-top"},fe={class:"tickets-list"},ke=["onClick"],ge={class:"line"},ye={class:"name"},be={class:"time"},Ve={class:"line"},he={class:"subject"},we={class:"tickets-chat"},Ce={key:0,class:"no-ticket"},xe={key:0,class:"chat-header"},Te={class:"info"},Se={class:"title"},je={class:"subtitle"},Ue={key:0},Ne={class:"controls"},$e={class:"chat-body"},qe={class:"meta"},Ae={class:"text"},Le={class:"chat-input"},Fe={__name:"Index",setup(Pe){var D;const y=le(),g=i(y.props.tickets||[]),U=i(y.props.counts||{}),q=i(y.props.agents||[]),A=i(y.props.filters||{status:"all",q:""}),f=i(A.value.q||""),k=i(A.value.status||"all"),r=i(((D=g.value[0])==null?void 0:D.id)||null),o=i(null),N=i([]),b=i(""),L=i(!1),F=i(!1),V=i(!1),n=i({customer_name:"",customer_phone:"",subject:"",priority:"medium",channel:"other"}),Q=oe(()=>{let a=g.value;if(k.value!=="all"&&(a=a.filter(e=>e.status===k.value)),f.value){const e=f.value.toLowerCase();a=a.filter(v=>v.customer_name.toLowerCase().includes(e)||v.subject.toLowerCase().includes(e))}return a});function R(a){k.value=a,$.get("/tickets",{status:a,q:f.value},{preserveState:!0,replace:!0,onSuccess:e=>{g.value=e.props.tickets,U.value=e.props.counts}})}function z(){$.get("/tickets",{status:k.value,q:f.value},{preserveState:!0,replace:!0,onSuccess:a=>{g.value=a.props.tickets,U.value=a.props.counts}})}async function H(){if(!(!n.value.customer_name||!n.value.subject))try{const a=await h.post("/tickets",{customer_name:n.value.customer_name,customer_phone:n.value.customer_phone||null,subject:n.value.subject,priority:n.value.priority,channel:n.value.channel});V.value=!1,n.value={customer_name:"",customer_phone:"",subject:"",priority:"medium",channel:"other"},await w(),B(a.data.id)}catch{alert("Failed to create ticket")}}async function P(a){if(a){F.value=!0,r.value=a;try{const e=await h.get(`/tickets/${a}`);o.value=e.data.ticket,N.value=e.data.messages}finally{F.value=!1}}}function B(a){P(a)}async function M(){var e;if(!b.value.trim()||!r.value||((e=o.value)==null?void 0:e.status)==="closed")return;L.value=!0;const a=b.value;b.value="";try{const v=await h.post(`/tickets/${r.value}/reply`,{message:a});N.value.push(v.data),await w()}finally{L.value=!1}}async function G(a){r.value&&(await h.post(`/tickets/${r.value}/status`,{status:a}),o.value&&(o.value.status=a),await w())}async function J(a){if(!r.value)return;await h.post(`/tickets/${r.value}/assign`,{assigned_to:a||null});const e=q.value.find(v=>v.id===a);o.value&&(o.value.assigned_to=a,o.value.assigned_name=e?e.name:null),await w()}async function w(){await $.get("/tickets",{status:k.value,q:f.value},{preserveState:!0,replace:!0,only:["tickets","counts"],onSuccess:a=>{g.value=a.props.tickets,U.value=a.props.counts}})}return ne(()=>{r.value&&P(r.value)}),ue(()=>y.props.tickets,a=>{a&&(g.value=a)}),(a,e)=>{const v=d("v-text-field"),C=d("v-btn"),x=d("v-chip"),W=d("v-chip-group"),T=d("v-select"),X=d("v-textarea"),Y=d("v-card-title"),Z=d("v-card-text"),ee=d("v-spacer"),te=d("v-card-actions"),ae=d("v-card"),se=d("v-dialog");return _(),p(S,null,[s(ie(de),{title:"Tickets"}),s(re,null,{title:u(()=>e[12]||(e[12]=[c("Tickets")])),default:u(()=>{var E,I;return[l("div",me,[l("aside",pe,[l("div",_e,[s(v,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),placeholder:"Search ticket...",density:"compact",variant:"solo",flat:"","hide-details":"","prepend-inner-icon":"mdi-magnify",class:"search",onKeyup:ce(z,["enter"])},null,8,["modelValue"]),s(C,{color:"primary",block:"",class:"mt-3",onClick:e[1]||(e[1]=t=>V.value=!0)},{default:u(()=>e[13]||(e[13]=[c(" + New Ticket ")])),_:1,__:[13]}),s(W,{modelValue:k.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>k.value=t),R],mandatory:"",class:"filters"},{default:u(()=>[s(x,{value:"all"},{default:u(()=>e[14]||(e[14]=[c("All")])),_:1,__:[14]}),s(x,{value:"pending"},{default:u(()=>e[15]||(e[15]=[c("Pending")])),_:1,__:[15]}),s(x,{value:"ongoing"},{default:u(()=>e[16]||(e[16]=[c("Ongoing")])),_:1,__:[16]}),s(x,{value:"closed"},{default:u(()=>e[17]||(e[17]=[c("Closed")])),_:1,__:[17]})]),_:1},8,["modelValue"])]),l("div",fe,[(_(!0),p(S,null,K(Q.value,t=>(_(),p("div",{key:t.id,class:j(["ticket",{active:t.id===r.value}]),onClick:Be=>B(t.id)},[l("div",ge,[l("span",ye,m(t.customer_name),1),l("span",be,m(t.last_message_at),1)]),l("div",Ve,[l("span",he,m(t.subject),1),l("span",{class:j(["status",t.status])},m(t.status),3)])],10,ke))),128))])]),l("section",we,[r.value?(_(),p(S,{key:1},[o.value?(_(),p("header",xe,[l("div",Te,[l("div",Se,[c(m(o.value.customer_name)+" ",1),l("span",{class:j(["badge",o.value.status])},m(o.value.status),3)]),l("div",je,[c(m(o.value.subject)+" ",1),o.value.assigned_name?(_(),p("span",Ue," · Assigned to "+m(o.value.assigned_name),1)):O("",!0)])]),l("div",Ne,[s(T,{density:"compact",variant:"outlined","hide-details":"",class:"control",items:[{title:"Pending",value:"pending"},{title:"Ongoing",value:"ongoing"},{title:"Closed",value:"closed"}],modelValue:o.value.status,"onUpdate:modelValue":[e[3]||(e[3]=t=>o.value.status=t),G]},null,8,["modelValue"]),s(T,{density:"compact",variant:"outlined","hide-details":"",clearable:"",class:"control",label:"Assign",items:q.value.map(t=>({title:t.name,value:t.id})),"model-value":o.value.assigned_to,"onUpdate:modelValue":J},null,8,["items","model-value"])])])):O("",!0),l("div",$e,[(_(!0),p(S,null,K(N.value,t=>(_(),p("div",{key:t.id,class:j(["bubble",t.sender_type])},[l("div",qe,m(t.sender_name??t.sender_type)+" · "+m(t.time),1),l("div",Ae,m(t.message),1)],2))),128))]),l("footer",Le,[s(X,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),"auto-grow":"",rows:"1","hide-details":"",placeholder:"Type a reply...",disabled:((E=o.value)==null?void 0:E.status)==="closed"},null,8,["modelValue","disabled"]),s(C,{color:"primary",disabled:((I=o.value)==null?void 0:I.status)==="closed",onClick:M},{default:u(()=>e[18]||(e[18]=[c(" SEND ")])),_:1,__:[18]},8,["disabled"])])],64)):(_(),p("div",Ce," Select a ticket "))])]),s(se,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=t=>V.value=t),"max-width":"420"},{default:u(()=>[s(ae,null,{default:u(()=>[s(Y,null,{default:u(()=>e[19]||(e[19]=[c("Create New Ticket")])),_:1,__:[19]}),s(Z,null,{default:u(()=>[s(v,{label:"Customer Name",modelValue:n.value.customer_name,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.customer_name=t)},null,8,["modelValue"]),s(v,{label:"Customer Phone",modelValue:n.value.customer_phone,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.customer_phone=t)},null,8,["modelValue"]),s(v,{label:"Subject",modelValue:n.value.subject,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.subject=t)},null,8,["modelValue"]),s(T,{label:"Priority",items:["low","medium","high"],modelValue:n.value.priority,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.priority=t)},null,8,["modelValue"]),s(T,{label:"Channel",items:["whatsapp","email","phone","other"],modelValue:n.value.channel,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.channel=t)},null,8,["modelValue"])]),_:1}),s(te,null,{default:u(()=>[s(ee),s(C,{text:"",onClick:e[10]||(e[10]=t=>V.value=!1)},{default:u(()=>e[20]||(e[20]=[c("Cancel")])),_:1,__:[20]}),s(C,{color:"primary",onClick:H},{default:u(()=>e[21]||(e[21]=[c("Create")])),_:1,__:[21]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1})],64)}}},Ke=ve(Fe,[["__scopeId","data-v-2b87af84"]]);export{Ke as default};
