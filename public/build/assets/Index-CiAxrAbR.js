import{A as Q}from"./AdminLayout-O7Oxasoz.js";import{a as J,r as v,D as O,b as n,f as z,o as _,w as l,e as o,i as t,d as b,h as G,F as H,k as K,t as r,j as p,Q as A,l as h}from"./app-BqckiNoC.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                    */const W={class:"d-flex justify-space-between align-center mb-4"},X={class:"text-caption"},Y={key:0},Z={class:"mt-4 d-flex justify-end"},ee={style:{"white-space":"pre-wrap"}},te={__name:"Index",setup(ae){var w,V;const m=J().props.value,f=v(m.approvals||{data:[],last_page:1}),d=v(((w=m.approvals)==null?void 0:w.current_page)||1),u=O({action:((V=m.filters)==null?void 0:V.action)||null}),q=[{title:"Requested",value:"requested"},{title:"Approved",value:"approved"},{title:"Rejected",value:"rejected"}],i=v(!1),y=v("");function R(){A.get(route("broadcast.approvals.index"),{action:u.action},{preserveState:!0,preserveScroll:!0})}function g(s){A.get(route("broadcast.approvals.index"),{page:s,action:u.action},{preserveState:!0,preserveScroll:!0})}function B(s){y.value=JSON.stringify(s.snapshot||s.campaign,null,2),i.value=!0}async function N(s){if(confirm('Approve campaign "'+s.campaign.name+'" ?'))try{await h.post(route("broadcast.approvals.approve",{approval:s.id})),alert("Approved"),g(d.value)}catch(e){console.error(e),alert("Error approving")}}async function F(s){const e=prompt("Reason for rejection:");if(e!==null)try{await h.post(route("broadcast.approvals.reject",{approval:s.id}),{note:e}),alert("Rejected"),g(d.value)}catch(x){console.error(x),alert("Error rejecting")}}return(s,e)=>{const x=n("v-select"),c=n("v-btn"),$=n("v-table"),D=n("v-pagination"),k=n("v-card"),E=n("v-col"),I=n("v-row"),L=n("v-card-title"),T=n("v-card-text"),U=n("v-card-actions"),P=n("v-dialog");return _(),z(Q,null,{title:l(()=>e[4]||(e[4]=[p("Broadcast Approvals")])),default:l(()=>[o(I,null,{default:l(()=>[o(E,{cols:"12"},{default:l(()=>[o(k,{class:"pa-4"},{default:l(()=>[t("div",W,[e[5]||(e[5]=t("div",null,[t("h3",{class:"text-h6 mb-0"},"Broadcast Approval Requests"),t("div",{class:"text-caption"},"Pending approvals for broadcast campaigns")],-1)),t("div",null,[o(x,{modelValue:u.action,"onUpdate:modelValue":e[0]||(e[0]=a=>u.action=a),items:q,dense:"","hide-details":"",style:{width:"200px"},label:"Filter action",onChange:R,clearable:""},null,8,["modelValue"])])]),o($,{dense:""},{default:l(()=>[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"Campaign"),t("th",null,"Requested By"),t("th",null,"Notes"),t("th",null,"Snapshot"),t("th",null,"Requested At"),t("th",{style:{width:"200px"}},"Action")])],-1)),t("tbody",null,[(_(!0),b(H,null,K(f.value.data,a=>{var C,j;return _(),b("tr",{key:a.id},[t("td",null,[t("div",null,[t("strong",null,r(a.campaign.name),1)]),t("div",X,"Template: "+r(((C=a.campaign.template)==null?void 0:C.name)||"-"),1)]),t("td",null,r(((j=a.requester)==null?void 0:j.name)||"â€”"),1),t("td",null,r(a.request_notes||"-"),1),t("td",null,[o(c,{text:"",small:"",onClick:S=>B(a)},{default:l(()=>e[6]||(e[6]=[p("View")])),_:2,__:[6]},1032,["onClick"])]),t("td",null,r(new Date(a.created_at).toLocaleString()),1),t("td",null,[o(c,{small:"",color:"success",class:"mr-2",onClick:S=>N(a)},{default:l(()=>e[7]||(e[7]=[p("Approve")])),_:2,__:[7]},1032,["onClick"]),o(c,{small:"",color:"error",onClick:S=>F(a)},{default:l(()=>e[8]||(e[8]=[p("Reject")])),_:2,__:[8]},1032,["onClick"])])])}),128)),f.value.data.length===0?(_(),b("tr",Y,e[9]||(e[9]=[t("td",{colspan:"6",class:"text-center"},"No approval requests.",-1)]))):G("",!0)])]),_:1,__:[10]}),t("div",Z,[o(D,{length:f.value.last_page,modelValue:d.value,"onUpdate:modelValue":[e[1]||(e[1]=a=>d.value=a),g]},null,8,["length","modelValue"])])]),_:1})]),_:1})]),_:1}),o(P,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value=a),"max-width":"800px"},{default:l(()=>[o(k,null,{default:l(()=>[o(L,null,{default:l(()=>e[11]||(e[11]=[p("Snapshot")])),_:1,__:[11]}),o(T,null,{default:l(()=>[t("pre",ee,r(y.value),1)]),_:1}),o(U,null,{default:l(()=>[o(c,{text:"",onClick:e[2]||(e[2]=a=>i.value=!1)},{default:l(()=>e[12]||(e[12]=[p("Close")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},re=M(te,[["__scopeId","data-v-4db77a77"]]);export{re as default};
