import{r as f,a as H,c as $,b as c,d as b,o as d,e as o,u as J,g as Q,w as s,f as B,h as t,t as m,i as u,F as S,j as W,k as _,l as x}from"./app-CsZa9FYx.js";import{A as X}from"./AdminLayout-B9id1OaC.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={key:0,class:"agents-dark"},h={class:"summary-grid mb-6"},ee={class:"summary-card"},le={class:"summary-card online"},te={class:"summary-card offline"},ne={class:"summary-card pending"},ae={class:"d-flex justify-space-between align-center mb-4"},oe={class:"d-flex justify-space-between mb-4"},se={class:"d-flex gap-2"},ie={class:"text-muted"},ue={class:"text-center"},re={class:"text-center"},de={class:"mb-4 text-white"},me={class:"d-flex justify-end mt-4 gap-2"},ve={__name:"Index",props:{agents:Array,counts:Object},setup(k){const v=f([...k.agents]),U=H(),j=$(()=>{var l,e;return((e=(l=U.props.auth)==null?void 0:l.user)==null?void 0:e.role)??"agent"}),D=$(()=>["superadmin","admin"].includes(j.value)),r=f("all"),y=f(""),p=f(!1),A=f(!1),w=f(!1),i=f({id:null,name:"",email:"",role:"Agent"});function z(l){return l.locked_until?new Date(l.locked_until)>new Date:!1}const E=$(()=>{let l=v.value||[];if(r.value!=="all"&&(l=l.filter(e=>e.status===r.value)),y.value){const e=y.value.toLowerCase();l=l.filter(a=>a.name.toLowerCase().includes(e)||a.email.toLowerCase().includes(e))}return l});function F(){A.value=!1,i.value={id:null,name:"",email:"",role:"Agent"},p.value=!0}function N(l){A.value=!0,i.value={id:l.id,name:l.name,email:l.email,role:l.role==="admin"?"Admin":l.role==="supervisor"?"Supervisor":"Agent"},p.value=!0}function O(l){return l==="admin"?"indigo-darken-3":l==="supervisor"?"teal-darken-2":"blue-darken-2"}function I(l){return l==="online"?"green-darken-2":l==="offline"?"grey-darken-1":"amber-darken-2"}async function R(l){if(!confirm("Approve this agent?"))return;await x.post(`/agents/${l}/approve`);const e=v.value.find(a=>a.id===l);e&&(e.approved_at=new Date)}async function M(l){confirm(`Unlock account ${l.name}?`)&&(await x.post(`/agents/${l.id}/unlock`),l.failed_login_attempts=0,l.locked_until=null)}async function P(){var l,e;w.value=!0;try{if(A.value){await x.put(`/agents/${i.value.id}`,i.value);const a=v.value.findIndex(g=>g.id===i.value.id);a!==-1&&(v.value[a]={...v.value[a],...i.value})}else{const a=await x.post("/agents",i.value);a!=null&&a.data&&v.value.push(a.data)}p.value=!1}catch(a){alert(((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)??"Failed to save agent")}finally{w.value=!1}}async function T(l){confirm(`Delete agent ${l.name}?`)&&(await x.delete(`/agents/${l.id}`),v.value=v.value.filter(e=>e.id!==l.id))}return(l,e)=>{const a=c("v-btn"),g=c("v-text-field"),C=c("v-chip"),q=c("v-table"),L=c("v-card"),K=c("v-select"),G=c("v-dialog");return d(),b(S,null,[o(J(Q),{title:"Agents"}),o(X,null,{title:s(()=>e[10]||(e[10]=[u("Agents")])),default:s(()=>[D.value?(d(),b("div",Z,[t("div",h,[t("div",ee,[e[11]||(e[11]=t("span",null,"Total Agents",-1)),t("h2",null,m(k.counts.all),1)]),t("div",le,[e[12]||(e[12]=t("span",null,"Online",-1)),t("h2",null,m(k.counts.online),1)]),t("div",te,[e[13]||(e[13]=t("span",null,"Offline",-1)),t("h2",null,m(k.counts.offline),1)]),t("div",ne,[e[14]||(e[14]=t("span",null,"Pending",-1)),t("h2",null,m(k.counts.pending),1)])]),o(L,{class:"main-card pa-5"},{default:s(()=>[t("div",ae,[e[16]||(e[16]=t("div",null,[t("h3",{class:"text-white"},"Agents Management"),t("p",{class:"text-muted"},"Kelola agent dan supervisor customer service")],-1)),o(a,{color:"primary","prepend-icon":"mdi-account-plus",onClick:F},{default:s(()=>e[15]||(e[15]=[u(" Add Agent ")])),_:1,__:[15]})]),t("div",oe,[t("div",se,[o(a,{size:"small",color:"primary",variant:r.value==="all"?"flat":"text",onClick:e[0]||(e[0]=n=>r.value="all")},{default:s(()=>e[17]||(e[17]=[u("All")])),_:1,__:[17]},8,["variant"]),o(a,{size:"small",color:"primary",variant:r.value==="online"?"flat":"text",onClick:e[1]||(e[1]=n=>r.value="online")},{default:s(()=>e[18]||(e[18]=[u("Online")])),_:1,__:[18]},8,["variant"]),o(a,{size:"small",color:"primary",variant:r.value==="offline"?"flat":"text",onClick:e[2]||(e[2]=n=>r.value="offline")},{default:s(()=>e[19]||(e[19]=[u("Offline")])),_:1,__:[19]},8,["variant"]),o(a,{size:"small",color:"primary",variant:r.value==="pending"?"flat":"text",onClick:e[3]||(e[3]=n=>r.value="pending")},{default:s(()=>e[20]||(e[20]=[u("Pending")])),_:1,__:[20]},8,["variant"])]),o(g,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=n=>y.value=n),density:"compact","prepend-inner-icon":"mdi-magnify",placeholder:"Search agent...","hide-details":"",style:{"max-width":"260px"}},null,8,["modelValue"])]),o(q,null,{default:s(()=>[e[24]||(e[24]=t("thead",null,[t("tr",null,[t("th",null,"Agent"),t("th",null,"Role"),t("th",null,"Status"),t("th",{class:"text-center"},"Approval"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[(d(!0),b(S,null,W(E.value,n=>(d(),b("tr",{key:n.id,class:"row-hover"},[t("td",null,[t("strong",null,m(n.name),1),e[21]||(e[21]=t("br",null,null,-1)),t("small",ie,m(n.email),1)]),t("td",null,[o(C,{size:"small",color:O(n.role)},{default:s(()=>[u(m(n.role),1)]),_:2},1032,["color"])]),t("td",null,[z(n)?(d(),_(C,{key:0,size:"small",class:"locked"},{default:s(()=>e[22]||(e[22]=[u(" ðŸ”’ Locked ")])),_:1,__:[22]})):(d(),_(C,{key:1,size:"small",color:I(n.status)},{default:s(()=>[u(m(n.status),1)]),_:2},1032,["color"]))]),t("td",ue,[n.approved_at?(d(),_(C,{key:1,size:"small",color:"blue-darken-2",variant:"tonal"},{default:s(()=>e[23]||(e[23]=[u(" Approved ")])),_:1,__:[23]})):(d(),_(a,{key:0,size:"small",icon:"mdi-check",color:"green",onClick:V=>R(n.id)},null,8,["onClick"]))]),t("td",re,[z(n)?(d(),_(a,{key:0,icon:"mdi-lock-open-variant",size:"small",class:"unlock",variant:"text",onClick:V=>M(n)},null,8,["onClick"])):B("",!0),o(a,{icon:"mdi-pencil",size:"small",variant:"text",onClick:V=>N(n)},null,8,["onClick"]),o(a,{icon:"mdi-delete",size:"small",color:"red",variant:"text",onClick:V=>T(n)},null,8,["onClick"])])]))),128))])]),_:1,__:[24]})]),_:1})])):B("",!0),o(G,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=n=>p.value=n),"max-width":"480","content-class":"agents-dialog-dark"},{default:s(()=>[o(L,{class:"pa-4"},{default:s(()=>[t("h3",de,m(A.value?"Edit Agent":"Add Agent"),1),o(g,{modelValue:i.value.name,"onUpdate:modelValue":e[5]||(e[5]=n=>i.value.name=n),label:"Full Name"},null,8,["modelValue"]),o(g,{modelValue:i.value.email,"onUpdate:modelValue":e[6]||(e[6]=n=>i.value.email=n),label:"Email"},null,8,["modelValue"]),o(K,{modelValue:i.value.role,"onUpdate:modelValue":e[7]||(e[7]=n=>i.value.role=n),items:["Admin","Supervisor","Agent"],label:"Role"},null,8,["modelValue"]),t("div",me,[o(a,{variant:"text",onClick:e[8]||(e[8]=n=>p.value=!1)},{default:s(()=>e[25]||(e[25]=[u("Cancel")])),_:1,__:[25]}),o(a,{color:"primary",loading:w.value,onClick:P},{default:s(()=>e[26]||(e[26]=[u("Save")])),_:1,__:[26]},8,["loading"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)}}},ge=Y(ve,[["__scopeId","data-v-a847c89e"]]);export{ge as default};
