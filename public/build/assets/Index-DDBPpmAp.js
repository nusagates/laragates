import{A as de}from"./AdminLayout-DDNgbf8P.js";import{r as c,m as ie,b as w,d as _,o as f,e as t,u as me,g as ve,w as n,i as o,j as i,h as k,F as M,k as Q,t as y,f as B,l as V}from"./app-z_qK7d6H.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                    */const fe={class:"d-flex align-center justify-space-between mb-4"},ye={class:"d-flex align-center gap-3"},ge={class:"font-weight-medium"},be={class:"text-center"},ce={class:"d-flex justify-center gap-2"},Ve={key:0},xe={class:"d-flex justify-end gap-2 mt-3"},we={class:"d-flex justify-end gap-2 mt-3"},_e={class:"d-flex justify-space-between align-center mb-3"},ke={class:"text-body-2 text-grey-darken-1"},Ce={class:"preview-area pa-4"},Se={key:0,class:"preview-header"},Ue={class:"wa-bubble"},Te=["innerHTML"],Ae={key:0,class:"wa-bubble-footer"},Ne={key:1,class:"wa-bubble-buttons"},$e={class:"d-flex justify-end gap-2 mt-4"},Je={key:0,class:"mb-3 text-body-2"},je={class:"d-flex justify-end gap-2 mt-4"},Ee={__name:"Index",setup(Le){const $=c([]),F=c(!1),A=c(!1),C=c(!1),S=c(!1),J=c(!1),s=c(null),u=c({name:"",category:"Utility",language:"id",header:"",body:"",footer:"",buttons:null}),p=c({to:"",language:"",componentsJson:""}),L=c(!1),m=c(!1),P=a=>{if(!a)return"grey";const e=a.toString().toLowerCase();return e==="approved"?"green":e==="submitted"?"blue":e==="draft"?"grey":e==="rejected"?"red":e==="pending"?"orange":"grey"};function z(a){if(!a)return null;try{return JSON.parse(a)}catch{return null}}function X(a){if(!a)return"-";try{return new Date(a).toISOString()}catch{return a}}async function x(){F.value=!0;try{const a=await V.get("/templates-list");$.value=Array.isArray(a.data)?a.data:[]}catch(a){try{const e=await V.get("/templates/all");$.value=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Failed loading templates",a,e),$.value=[]}}finally{F.value=!1}}async function q(){var a,e,r;L.value=!0;try{const d={...u.value};typeof d.buttons=="string"&&d.buttons.trim()&&(d.buttons=z(d.buttons)||d.buttons),C.value&&((a=s.value)!=null&&a.id)?await V.put(`/templates/${s.value.id}`,d):await V.post("/templates",d),A.value=!1,C.value=!1,await x()}catch(d){console.error(d),alert("Failed to save template: "+(((r=(e=d.response)==null?void 0:e.data)==null?void 0:r.message)||d.message))}finally{L.value=!1}}async function Z(a){if(confirm("Delete this template?")){m.value=!0;try{await V.delete(`/templates/${a}`),await x()}catch(e){console.error(e),alert("Failed to delete template")}finally{m.value=!1}}}async function h(a){var e,r;if(confirm("Sync this template with provider?")){m.value=!0;try{await V.post(`/templates/${a}/sync`),await x(),alert("Synced successfully (server response)")}catch(d){console.error(d),alert("Sync failed: "+(((r=(e=d.response)==null?void 0:e.data)==null?void 0:r.error)||d.message))}finally{m.value=!1}}}async function ee(a){if(confirm("Submit this template for approval?")){m.value=!0;try{await V.post(`/templates/${a}/submit`),await x(),S.value=!1}catch(e){console.error(e),alert("Submit failed")}finally{m.value=!1}}}async function le(a){if(confirm("Approve this template?")){m.value=!0;try{await V.post(`/templates/${a}/approve`),await x(),S.value=!1}catch(e){console.error(e),alert("Approve failed")}finally{m.value=!1}}}async function te(a){const e=prompt("Reason for rejection (visible to submitter):");if(e){m.value=!0;try{await V.post(`/templates/${a}/reject`,{reason:e}),await x(),S.value=!1}catch(r){console.error(r),alert("Reject failed")}finally{m.value=!1}}}function ae(a){s.value=a,p.value={to:"",language:a.language||"id",componentsJson:""},J.value=!0}async function oe(){var a,e,r,d;if(s.value){if(!p.value.to){alert("Provide a phone number to send to");return}m.value=!0;try{const g={to:p.value.to,language:p.value.language||s.value.language};if(p.value.componentsJson&&p.value.componentsJson.trim())try{g.components=JSON.parse(p.value.componentsJson)}catch{alert("Invalid components JSON"),m.value=!1;return}const b=await V.post(`/templates/${s.value.id}/send`,g);(a=b==null?void 0:b.data)!=null&&a.warning?alert("Warning: "+b.data.warning):(e=b==null?void 0:b.data)!=null&&e.sent||(b==null?void 0:b.status)===200?alert("Template sent (check logs/provider)."):alert("Send request finished, check server response."),J.value=!1,await x()}catch(g){console.error(g),alert("Send failed: "+(((d=(r=g.response)==null?void 0:r.data)==null?void 0:d.error)||g.message))}finally{m.value=!1}}}function ne(){A.value=!0,C.value=!1,s.value=null,u.value={name:"",category:"Utility",language:"id",header:"",body:"",footer:"",buttons:null}}function se(a){s.value=a,C.value=!0,A.value=!1,u.value={name:a.name||"",category:a.category||"Utility",language:a.language||"id",header:a.header||"",body:a.body||"",footer:a.footer||"",buttons:a.buttons&&typeof a.buttons=="object"?JSON.stringify(a.buttons,null,2):a.buttons||null}}function ue(a){s.value=a,S.value=!0}return ie(x),(a,e)=>{const r=w("v-btn"),d=w("v-chip"),g=w("v-icon"),b=w("v-table"),N=w("v-card"),U=w("v-text-field"),j=w("v-select"),E=w("v-textarea"),O=w("v-dialog");return f(),_(M,null,[t(me(ve),{title:"Templates"}),t(de,null,{title:n(()=>e[28]||(e[28]=[i("Templates")])),default:n(()=>[t(N,{elevation:"3",class:"pa-4"},{default:n(()=>[o("div",fe,[e[31]||(e[31]=o("div",null,[o("h3",{class:"text-h6"},"WhatsApp Message Templates"),o("p",{class:"text-body-2 text-grey-darken-1"},"Kelola template pesan resmi WhatsApp (create, sync, workflow, send).")],-1)),o("div",ye,[t(r,{color:"primary","prepend-icon":"mdi-sync",onClick:x,loading:F.value},{default:n(()=>e[29]||(e[29]=[i(" Refresh ")])),_:1,__:[29]},8,["loading"]),t(r,{color:"primary","prepend-icon":"mdi-plus",onClick:ne,class:"ml-2"},{default:n(()=>e[30]||(e[30]=[i(" NEW TEMPLATE ")])),_:1,__:[30]})])]),t(b,{"fixed-header":"",height:"420",density:"comfortable"},{default:n(()=>[e[38]||(e[38]=o("thead",null,[o("tr",null,[o("th",null,"Name"),o("th",null,"Category"),o("th",null,"Language"),o("th",null,"Status"),o("th",null,"Last Updated"),o("th",{class:"text-center"},"Action")])],-1)),o("tbody",null,[(f(!0),_(M,null,Q($.value,l=>(f(),_("tr",{key:l.id,class:"hover-row"},[o("td",ge,y(l.name),1),o("td",null,y(l.category),1),o("td",null,y(l.language),1),o("td",null,[t(d,{color:P(l.status),size:"small",class:"text-white",variant:"flat"},{default:n(()=>[i(y(l.status),1)]),_:2},1032,["color"])]),o("td",null,y(X(l.updated_at)),1),o("td",be,[o("div",ce,[t(r,{icon:"",size:"small",variant:"text",onClick:T=>ue(l),title:"Preview"},{default:n(()=>[t(g,null,{default:n(()=>e[32]||(e[32]=[i("mdi-eye")])),_:1,__:[32]})]),_:2},1032,["onClick"]),t(r,{icon:"",size:"small",variant:"text",onClick:T=>se(l),title:"Edit"},{default:n(()=>[t(g,null,{default:n(()=>e[33]||(e[33]=[i("mdi-pencil")])),_:1,__:[33]})]),_:2},1032,["onClick"]),t(r,{icon:"",size:"small",color:"blue",variant:"flat",onClick:T=>h(l.id),title:"Sync with Provider"},{default:n(()=>[t(g,null,{default:n(()=>e[34]||(e[34]=[i("mdi-sync")])),_:1,__:[34]})]),_:2},1032,["onClick"]),t(r,{icon:"",size:"small",color:"teal",variant:"flat",onClick:T=>ae(l),title:"Send Template"},{default:n(()=>[t(g,null,{default:n(()=>e[35]||(e[35]=[i("mdi-send")])),_:1,__:[35]})]),_:2},1032,["onClick"]),t(r,{icon:"",size:"small",color:"red",variant:"flat",onClick:T=>Z(l.id),title:"Delete"},{default:n(()=>[t(g,null,{default:n(()=>e[36]||(e[36]=[i("mdi-delete")])),_:1,__:[36]})]),_:2},1032,["onClick"])])])]))),128)),$.value.length?k("",!0):(f(),_("tr",Ve,e[37]||(e[37]=[o("td",{colspan:"6",class:"text-center pa-4 text-grey"},"Belum ada template. Klik NEW TEMPLATE untuk membuat.",-1)])))])]),_:1,__:[38]})]),_:1}),t(O,{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=l=>A.value=l),"max-width":"640"},{default:n(()=>[t(N,{class:"pa-4"},{default:n(()=>[e[41]||(e[41]=o("h3",{class:"text-h6 mb-3"},"Add New Template",-1)),t(U,{modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value.name=l),label:"Template Name",class:"mb-3",dense:""},null,8,["modelValue"]),t(j,{modelValue:u.value.category,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.category=l),items:["Utility","Marketing","Authentication"],label:"Category",class:"mb-3",dense:""},null,8,["modelValue"]),t(j,{modelValue:u.value.language,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value.language=l),items:["id","en"],label:"Language",class:"mb-3",dense:""},null,8,["modelValue"]),t(U,{modelValue:u.value.header,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.header=l),label:"Header (optional)",class:"mb-3",dense:""},null,8,["modelValue"]),t(E,{modelValue:u.value.body,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.body=l),label:"Body (required)",rows:"4",class:"mb-3",dense:""},null,8,["modelValue"]),t(U,{modelValue:u.value.footer,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.footer=l),label:"Footer (optional)",class:"mb-3",dense:""},null,8,["modelValue"]),t(E,{modelValue:u.value.buttons,"onUpdate:modelValue":e[6]||(e[6]=l=>u.value.buttons=l),label:"Buttons JSON (optional)",rows:"3",hint:'Example: [{"type":"quick_reply","text":"Yes"}]',class:"mb-3",dense:""},null,8,["modelValue"]),o("div",xe,[t(r,{variant:"text",onClick:e[7]||(e[7]=l=>A.value=!1)},{default:n(()=>e[39]||(e[39]=[i("Cancel")])),_:1,__:[39]}),t(r,{color:"primary",loading:L.value,onClick:q},{default:n(()=>e[40]||(e[40]=[i("Save")])),_:1,__:[40]},8,["loading"])])]),_:1,__:[41]})]),_:1},8,["modelValue"]),t(O,{modelValue:C.value,"onUpdate:modelValue":e[17]||(e[17]=l=>C.value=l),"max-width":"640"},{default:n(()=>[t(N,{class:"pa-4"},{default:n(()=>[e[44]||(e[44]=o("h3",{class:"text-h6 mb-3"},"Edit Template",-1)),t(U,{modelValue:u.value.name,"onUpdate:modelValue":e[9]||(e[9]=l=>u.value.name=l),label:"Template Name",class:"mb-3",dense:""},null,8,["modelValue"]),t(j,{modelValue:u.value.category,"onUpdate:modelValue":e[10]||(e[10]=l=>u.value.category=l),items:["Utility","Marketing","Authentication"],label:"Category",class:"mb-3",dense:""},null,8,["modelValue"]),t(j,{modelValue:u.value.language,"onUpdate:modelValue":e[11]||(e[11]=l=>u.value.language=l),items:["id","en"],label:"Language",class:"mb-3",dense:""},null,8,["modelValue"]),t(U,{modelValue:u.value.header,"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.header=l),label:"Header (optional)",class:"mb-3",dense:""},null,8,["modelValue"]),t(E,{modelValue:u.value.body,"onUpdate:modelValue":e[13]||(e[13]=l=>u.value.body=l),label:"Body (required)",rows:"4",class:"mb-3",dense:""},null,8,["modelValue"]),t(U,{modelValue:u.value.footer,"onUpdate:modelValue":e[14]||(e[14]=l=>u.value.footer=l),label:"Footer (optional)",class:"mb-3",dense:""},null,8,["modelValue"]),t(E,{modelValue:u.value.buttons,"onUpdate:modelValue":e[15]||(e[15]=l=>u.value.buttons=l),label:"Buttons JSON (optional)",rows:"3",hint:'Example: [{"type":"quick_reply","text":"Yes"}]',class:"mb-3",dense:""},null,8,["modelValue"]),o("div",we,[t(r,{variant:"text",onClick:e[16]||(e[16]=l=>C.value=!1)},{default:n(()=>e[42]||(e[42]=[i("Cancel")])),_:1,__:[42]}),t(r,{color:"primary",loading:L.value,onClick:q},{default:n(()=>e[43]||(e[43]=[i("Update")])),_:1,__:[43]},8,["loading"])])]),_:1,__:[44]})]),_:1},8,["modelValue"]),t(O,{modelValue:S.value,"onUpdate:modelValue":e[22]||(e[22]=l=>S.value=l),"max-width":"720"},{default:n(()=>[t(N,{class:"pa-4"},{default:n(()=>{var l,T,D,I,W,H,R,K,Y,G;return[o("div",_e,[o("div",null,[e[45]||(e[45]=o("h3",{class:"text-h6 mb-1"},"Template Preview",-1)),o("div",ke,y(((l=s.value)==null?void 0:l.name)||"")+" — "+y(((T=s.value)==null?void 0:T.category)||""),1)]),o("div",null,[t(d,{color:P((D=s.value)==null?void 0:D.status),class:"text-white"},{default:n(()=>{var v;return[i(y((v=s.value)==null?void 0:v.status),1)]}),_:1},8,["color"])])]),o("div",Ce,[(I=s.value)!=null&&I.header?(f(),_("div",Se,y(s.value.header),1)):k("",!0),o("div",Ue,[o("div",{class:"wa-bubble-body",innerHTML:(W=s.value)==null?void 0:W.body},null,8,Te),(H=s.value)!=null&&H.footer?(f(),_("div",Ae,y(s.value.footer),1)):k("",!0),(R=s.value)!=null&&R.buttons?(f(),_("div",Ne,[(f(!0),_(M,null,Q(typeof s.value.buttons=="string"?z(s.value.buttons)||[]:s.value.buttons||[],(v,re)=>(f(),B(d,{key:re,class:"ma-1",small:""},{default:n(()=>[i(y((v==null?void 0:v.text)||(v==null?void 0:v.title)||JSON.stringify(v).slice(0,20)),1)]),_:2},1024))),128))])):k("",!0)])]),o("div",$e,[((K=s.value)==null?void 0:K.status)==="draft"?(f(),B(r,{key:0,color:"blue",onClick:e[18]||(e[18]=v=>ee(s.value.id))},{default:n(()=>e[46]||(e[46]=[i("Submit for Approval")])),_:1,__:[46]})):k("",!0),((Y=s.value)==null?void 0:Y.status)==="submitted"?(f(),B(r,{key:1,color:"green",onClick:e[19]||(e[19]=v=>le(s.value.id))},{default:n(()=>e[47]||(e[47]=[i("Approve")])),_:1,__:[47]})):k("",!0),((G=s.value)==null?void 0:G.status)==="submitted"?(f(),B(r,{key:2,color:"red",onClick:e[20]||(e[20]=v=>te(s.value.id))},{default:n(()=>e[48]||(e[48]=[i("Reject")])),_:1,__:[48]})):k("",!0),t(r,{variant:"text",onClick:e[21]||(e[21]=v=>S.value=!1)},{default:n(()=>e[49]||(e[49]=[i("Close")])),_:1,__:[49]})])]}),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:J.value,"onUpdate:modelValue":e[27]||(e[27]=l=>J.value=l),"max-width":"600"},{default:n(()=>[t(N,{class:"pa-4"},{default:n(()=>[e[53]||(e[53]=o("h3",{class:"text-h6 mb-2"},"Send Template",-1)),s.value?(f(),_("div",Je,[e[50]||(e[50]=o("strong",null,"Template:",-1)),i(" "+y(s.value.name)+" — ",1),o("small",null,y(s.value.language),1)])):k("",!0),t(U,{modelValue:p.value.to,"onUpdate:modelValue":e[23]||(e[23]=l=>p.value.to=l),label:"Phone number (e.g. 628123...)",class:"mb-3",dense:""},null,8,["modelValue"]),t(j,{modelValue:p.value.language,"onUpdate:modelValue":e[24]||(e[24]=l=>p.value.language=l),items:["id","en"],label:"Language (override)",class:"mb-3",dense:""},null,8,["modelValue"]),t(E,{modelValue:p.value.componentsJson,"onUpdate:modelValue":e[25]||(e[25]=l=>p.value.componentsJson=l),label:"Optional components JSON (advanced)",rows:"4",hint:'Example: [{"type":"body","parameters":[{"type":"text","text":"Alice"}]}]',dense:""},null,8,["modelValue"]),o("div",je,[t(r,{variant:"text",onClick:e[26]||(e[26]=l=>J.value=!1)},{default:n(()=>e[51]||(e[51]=[i("Cancel")])),_:1,__:[51]}),t(r,{color:"primary",loading:m.value,onClick:oe},{default:n(()=>e[52]||(e[52]=[i("Send")])),_:1,__:[52]},8,["loading"])])]),_:1,__:[53]})]),_:1},8,["modelValue"])]),_:1})],64)}}},Pe=pe(Ee,[["__scopeId","data-v-fe39158f"]]);export{Pe as default};
