import{r as f,x as b,m as C,d as a,o,h as l,f as i,F as k,j as N,t as g,i as B,D,l as L,z as w}from"./app-CsZa9FYx.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"wrapper"},M={key:0,class:"no-room"},R={key:0,class:"loading"},$={key:0,class:"date-separator"},z=["src"],A=["href"],F={key:2},j={class:"time"},H={key:2,class:"no-msg"},W={__name:"Room",props:{roomId:Number},setup(h){const r=h,u=f(!1),n=f([]),c=f(null);let m=null;async function p(){if(!r.roomId)return n.value=[];u.value=!0;try{const t=await L.get(`/chat/sessions/${r.roomId}/messages`);n.value=t.data,await w(),v()}catch(t){console.error(t)}finally{u.value=!1}}function v(){c.value&&(c.value.scrollTop=c.value.scrollHeight)}function y(){m&&window.Echo.leave(`chat-session.${m}`),r.roomId&&(m=r.roomId,window.Echo.private(`chat-session.${r.roomId}`).listen(".MessageSent",t=>{n.value.find(e=>e.id===t.message.id)||(n.value.push(t.message),w(()=>v()))}))}b(()=>r.roomId,()=>{p(),y()}),C(()=>{p(),y(),console.log("mounted")});function I(t){return t.is_outgoing?"bubble-me":"bubble-you"}function _(t){const s=new Date(t),e=new Date,d=new Date;return d.setDate(e.getDate()-1),s.toDateString()===e.toDateString()?"Today":s.toDateString()===d.toDateString()?"Yesterday":s.toLocaleDateString()}function S(t){if(t===0)return!0;const s=_(n.value[t].created_at),e=_(n.value[t-1].created_at);return s!==e}const x=new Audio("/sounds/message.mp3");return b(n,(t,s)=>{s.length&&t.length>s.length&&(t[t.length-1].is_outgoing||x.play().catch(()=>{}))}),(t,s)=>(o(),a("div",E,[h.roomId?(o(),a("div",{key:1,ref_key:"panel",ref:c,class:"messages"},[u.value?(o(),a("div",R,s[1]||(s[1]=[l("small",null,"Loading...",-1)]))):i("",!0),(o(!0),a(k,null,N(n.value,(e,d)=>(o(),a(k,{key:e.id},[S(d)?(o(),a("div",$,g(_(e.created_at)),1)):i("",!0),l("div",{class:D(["bubble",I(e)])},[e.media_type&&e.media_type.startsWith("image")?(o(),a("img",{key:0,src:e.media_url,class:"img"},null,8,z)):e.media_type?(o(),a("a",{key:1,href:e.media_url,target:"_blank",class:"file"}," ðŸ“Ž "+g(e.message??"Attachment"),9,A)):(o(),a("span",F,g(e.message),1)),l("div",j,[B(g(e.created_at)+" ",1),e.is_outgoing?(o(),a("span",{key:0,class:D(["status",{seen:e.is_seen}])}," âœ”âœ” ",2)):i("",!0)])],2)],64))),128)),i("",!0),!n.value.length&&!u.value?(o(),a("div",H,s[3]||(s[3]=[l("small",null,"No messages.",-1)]))):i("",!0)],512)):(o(),a("div",M,s[0]||(s[0]=[l("small",null,"Select a chat...",-1)])))]))}},G=T(W,[["__scopeId","data-v-abe444e2"]]);export{G as default};
