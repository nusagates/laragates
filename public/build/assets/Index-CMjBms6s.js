import{a as Y,r as c,c as Z,n as ee,q as te,b as v,d as r,o as u,e as a,u as se,g as ae,w as o,f as l,v as le,h as k,t as n,i as L,F as x,j as E,l as oe,p as N,m as V,Q as j}from"./app-XQ9sXrzo.js";import{_ as ne,A as ie}from"./AdminLayout-BSfQMc_f.js";const ce={class:"tickets-flex"},ue={class:"tickets-sidebar"},de={class:"tickets-scroll"},re={class:"ticket-line"},ve={class:"ticket-name"},pe={class:"ticket-time"},_e={class:"ticket-sub"},me={class:"ticket-subject"},ke={key:0,class:"no-tickets"},ge={class:"tickets-detail"},fe={key:0,class:"no-select"},ye={key:0,class:"tickets-header"},he={class:"ticket-title"},be={class:"ticket-desc"},we={class:"ticket-actions"},xe={key:1,class:"tickets-body"},Ve={class:"bubble-meta"},Ce={key:0,class:"no-messages"},Se={key:2,class:"tickets-body loading-center"},Te={class:"tickets-input"},qe={__name:"Index",setup(Le){var F;const y=Y(),g=c(y.props.tickets||[]),_=c(y.props.counts||{}),A=c(y.props.agents||[]),U=c(y.props.filters||{status:"all",q:""}),m=c(U.value.q||""),p=c(U.value.status||"all"),d=c(((F=g.value[0])==null?void 0:F.id)||null),i=c(null),w=c([]),h=c(""),C=c(!1),S=c(!1),I=e=>e==="pending"?"orange":e==="ongoing"?"blue":e==="closed"?"green":"grey",$=Z(()=>{let e=g.value;if(p.value&&p.value!=="all"&&(e=e.filter(t=>t.status===p.value)),m.value){const t=m.value.toLowerCase();e=e.filter(f=>f.customer_name.toLowerCase().includes(t)||f.subject.toLowerCase().includes(t))}return e});function K(e){p.value=e,j.get("/tickets",{status:e,q:m.value},{preserveState:!0,replace:!0,onSuccess:t=>{g.value=t.props.tickets,_.value=t.props.counts}})}function O(){j.get("/tickets",{status:p.value,q:m.value},{preserveState:!0,replace:!0,onSuccess:e=>{g.value=e.props.tickets,_.value=e.props.counts}})}async function B(e){if(e){S.value=!0,d.value=e;try{const t=await V.get(`/tickets/${e}`);i.value=t.data.ticket,w.value=t.data.messages}finally{S.value=!1}}}function P(e){B(e)}async function Q(){if(!h.value.trim()||!d.value)return;C.value=!0;const e=h.value;h.value="";try{const t=await V.post(`/tickets/${d.value}/reply`,{message:e});w.value.push(t.data),await T()}finally{C.value=!1}}async function R(e){d.value&&(await V.post(`/tickets/${d.value}/status`,{status:e}),i.value&&(i.value.status=e),await T())}async function M(e){if(!d.value)return;await V.post(`/tickets/${d.value}/assign`,{assigned_to:e||null});const t=A.value.find(f=>f.id===e);i.value&&(i.value.assigned_to=e,i.value.assigned_name=t?t.name:null),await T()}async function T(){await j.get("/tickets",{status:p.value,q:m.value},{preserveState:!0,replace:!0,only:["tickets","counts"],onSuccess:e=>{g.value=e.props.tickets,_.value=e.props.counts}})}return ee(()=>{d.value&&B(d.value)}),te(()=>y.props.tickets,e=>{e&&(g.value=e)}),(e,t)=>{const f=v("v-text-field"),b=v("v-chip"),G=v("v-chip-group"),q=v("v-divider"),H=v("v-list-item"),J=v("v-list"),z=v("v-card"),D=v("v-select"),W=v("v-textarea"),X=v("v-btn");return u(),r(x,null,[a(se(ae),{title:"Tickets"}),a(ie,null,{title:o(()=>t[4]||(t[4]=[k("Tickets")])),default:o(()=>[l("div",ce,[l("div",ue,[a(z,{class:"tickets-sidebar-card",elevation:"1"},{default:o(()=>[a(f,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),placeholder:"Search ticket...",density:"compact",variant:"solo",flat:"","hide-details":"",rounded:"",clearable:"","prepend-inner-icon":"mdi-magnify",onKeyup:le(O,["enter"]),class:"tickets-search"},null,8,["modelValue"]),a(G,{modelValue:p.value,"onUpdate:modelValue":[t[1]||(t[1]=s=>p.value=s),K],mandatory:"",class:"tickets-chip-group"},{default:o(()=>[a(b,{value:"all",filter:""},{default:o(()=>[k(" All ("+n(_.value.all??0)+") ",1)]),_:1}),a(b,{value:"pending",filter:"",color:"orange"},{default:o(()=>[k(" Pending ("+n(_.value.pending??0)+") ",1)]),_:1}),a(b,{value:"ongoing",filter:"",color:"blue"},{default:o(()=>[k(" Ongoing ("+n(_.value.ongoing??0)+") ",1)]),_:1}),a(b,{value:"closed",filter:"",color:"green"},{default:o(()=>[k(" Closed ("+n(_.value.closed??0)+") ",1)]),_:1})]),_:1},8,["modelValue"]),a(q),l("div",de,[a(J,{density:"compact"},{default:o(()=>[(u(!0),r(x,null,E($.value,s=>(u(),oe(H,{key:s.id,class:N([{"active-ticket":s.id===d.value},"tickets-item"]),onClick:Ne=>P(s.id)},{default:o(()=>[l("div",re,[l("span",ve,n(s.customer_name),1),l("small",pe,n(s.last_message_at),1)]),l("div",_e,[l("span",me,n(s.subject),1),a(b,{color:I(s.status),size:"x-small",label:"",class:"ticket-badge text-capitalize"},{default:o(()=>[k(n(s.status),1)]),_:2},1032,["color"])])]),_:2},1032,["class","onClick"]))),128))]),_:1}),$.value.length?L("",!0):(u(),r("div",ke," No tickets "))])]),_:1})]),l("div",ge,[a(z,{class:"tickets-window",elevation:"1"},{default:o(()=>[d.value?(u(),r(x,{key:1},[i.value?(u(),r("div",ye,[l("div",null,[l("h3",he,n(i.value.customer_name),1),l("div",be,n(i.value.subject),1)]),l("div",we,[a(D,{items:[{value:"pending",title:"Pending"},{value:"ongoing",title:"Ongoing"},{value:"closed",title:"Closed"}],modelValue:i.value.status,"onUpdate:modelValue":[t[2]||(t[2]=s=>i.value.status=s),R],density:"compact",variant:"outlined","hide-details":"",class:"mr-2",style:{"max-width":"140px"}},null,8,["modelValue"]),a(D,{items:A.value.map(s=>({value:s.id,title:s.name})),"model-value":i.value.assigned_to,density:"compact",variant:"outlined","hide-details":"",clearable:"",label:"Assign",style:{"max-width":"180px"},"onUpdate:modelValue":M},null,8,["items","model-value"])])])):L("",!0),a(q),S.value?(u(),r("div",Se," Loading... ")):(u(),r("div",xe,[(u(!0),r(x,null,E(w.value,s=>(u(),r("div",{key:s.id,class:N(["bubble-wrapper",s.sender_type])},[l("div",Ve,n(s.sender_name??s.sender_type)+" Â· "+n(s.time),1),l("div",{class:N(["bubble",s.sender_type])},n(s.message),3)],2))),128)),w.value.length?L("",!0):(u(),r("div",Ce," No messages yet "))])),a(q),l("div",Te,[a(W,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s),placeholder:"Type a reply...",rows:"1","auto-grow":"",variant:"outlined","hide-details":"",class:"reply-text"},null,8,["modelValue"]),a(X,{color:"primary",loading:C.value,onClick:Q,class:"reply-btn"},{default:o(()=>t[5]||(t[5]=[k(" SEND ")])),_:1,__:[5]},8,["loading"])])],64)):(u(),r("div",fe," Select a ticket to view detail "))]),_:1})])])]),_:1})],64)}}},Ue=ne(qe,[["__scopeId","data-v-60df6a9b"]]);export{Ue as default};
