import{A as te}from"./AdminLayout-B9id1OaC.js";import{r as v,m as ne,b as g,d as T,o as k,e as t,u as oe,g as ue,w as o,h as n,i as r,f as N,F as q,j as se,t as f,k as B,l as p}from"./app-CsZa9FYx.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"templates-dark"},ie={class:"header-card mb-6"},me={class:"d-flex gap-2"},ve={class:"text-center actions"},pe={key:0},fe={class:"d-flex justify-end mt-4"},ge={class:"d-flex justify-end mt-4"},ye={class:"text-muted"},Ve={class:"wa-preview"},be={class:"d-flex justify-end mt-4 gap-2"},ke={class:"d-flex justify-end mt-4"},ce={__name:"Index",setup(_e){const c=v([]),J=v(!1),w=v(!1),_=v(!1),y=v(!1),x=v(!1),d=v(null),u=v({name:"",category:"Utility",language:"id",header:"",body:"",footer:"",buttons:null}),i=v({to:"",language:"",componentsJson:""}),A=v(!1),m=v(!1),M=l=>l&&{approved:"green-darken-2",submitted:"blue-darken-2",draft:"grey-darken-1",rejected:"red-darken-2",pending:"amber-darken-2"}[l.toLowerCase()]||"grey-darken-1";function z(l){try{return JSON.parse(l)}catch{return null}}function K(l){if(!l)return"-";try{return new Date(l).toLocaleString()}catch{return l}}async function V(){J.value=!0;try{const l=await p.get("/templates-list");c.value=Array.isArray(l.data)?l.data:[]}catch{const l=await p.get("/templates/all");c.value=Array.isArray(l.data)?l.data:[]}J.value=!1}async function O(){A.value=!0;try{const l={...u.value};typeof l.buttons=="string"&&l.buttons.trim()&&(l.buttons=z(l.buttons)||l.buttons),_.value?await p.put(`/templates/${d.value.id}`,l):await p.post("/templates",l),w.value=!1,_.value=!1,await V()}finally{A.value=!1}}async function W(l){confirm("Delete template?")&&(await p.delete(`/templates/${l}`),c.value=c.value.filter(e=>e.id!==l))}async function G(l){confirm("Sync template?")&&(m.value=!0,await p.post(`/templates/${l}/sync`),await V(),m.value=!1)}async function H(l){confirm("Submit for approval?")&&(m.value=!0,await p.post(`/templates/${l}/submit`),y.value=!1,await V(),m.value=!1)}async function Q(l){confirm("Approve template?")&&(m.value=!0,await p.post(`/templates/${l}/approve`),y.value=!1,await V(),m.value=!1)}async function X(l){const e=prompt("Reason:");e&&(m.value=!0,await p.post(`/templates/${l}/reject`,{reason:e}),y.value=!1,await V(),m.value=!1)}function Y(){w.value=!0,u.value={name:"",category:"Utility",language:"id",header:"",body:"",footer:"",buttons:null}}function Z(l){d.value=l,_.value=!0,u.value={name:l.name,category:l.category,language:l.language,header:l.header,body:l.body,footer:l.footer,buttons:l.buttons?JSON.stringify(l.buttons,null,2):null}}function h(l){d.value=l,y.value=!0}function ee(l){d.value=l,i.value={to:"",language:l.language||"id",componentsJson:""},x.value=!0}async function le(){if(!i.value.to)return alert("Phone required");m.value=!0;const l={to:i.value.to,language:i.value.language};i.value.componentsJson.trim()&&(l.components=JSON.parse(i.value.componentsJson)),await p.post(`/templates/${d.value.id}/send`,l),x.value=!1,m.value=!1}return ne(V),(l,e)=>{const s=g("v-btn"),D=g("v-chip"),ae=g("v-table"),U=g("v-card"),L=g("v-text-field"),$=g("v-select"),j=g("v-textarea"),S=g("v-dialog");return k(),T(q,null,[t(oe(ue),{title:"Templates"}),t(te,null,{title:o(()=>e[22]||(e[22]=[r("Templates")])),default:o(()=>[n("div",re,[n("div",ie,[e[25]||(e[25]=n("div",null,[n("h3",null,"WhatsApp Templates"),n("p",null,"Kelola template dan sinkronisasi ke Meta API")],-1)),n("div",me,[t(s,{color:"primary","prepend-icon":"mdi-sync",onClick:V,loading:J.value},{default:o(()=>e[23]||(e[23]=[r(" Refresh ")])),_:1,__:[23]},8,["loading"]),t(s,{color:"primary","prepend-icon":"mdi-plus",onClick:Y},{default:o(()=>e[24]||(e[24]=[r(" New Template ")])),_:1,__:[24]})])]),t(U,{class:"main-card pa-0"},{default:o(()=>[t(ae,null,{default:o(()=>[e[27]||(e[27]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"Category"),n("th",null,"Lang"),n("th",null,"Status"),n("th",null,"Updated"),n("th",{class:"text-center"},"Action")])],-1)),n("tbody",null,[(k(!0),T(q,null,se(c.value,a=>(k(),T("tr",{key:a.id,class:"row-hover"},[n("td",null,[n("strong",null,f(a.name),1)]),n("td",null,f(a.category),1),n("td",null,f(a.language),1),n("td",null,[t(D,{size:"small",color:M(a.status)},{default:o(()=>[r(f(a.status),1)]),_:2},1032,["color"])]),n("td",null,f(K(a.updated_at)),1),n("td",ve,[t(s,{icon:"mdi-eye",variant:"text",onClick:b=>h(a)},null,8,["onClick"]),t(s,{icon:"mdi-pencil",variant:"text",onClick:b=>Z(a)},null,8,["onClick"]),t(s,{icon:"mdi-sync",color:"blue",onClick:b=>G(a.id)},null,8,["onClick"]),t(s,{icon:"mdi-send",color:"teal",onClick:b=>ee(a)},null,8,["onClick"]),t(s,{icon:"mdi-delete",color:"red",onClick:b=>W(a.id)},null,8,["onClick"])])]))),128)),c.value.length?N("",!0):(k(),T("tr",pe,e[26]||(e[26]=[n("td",{colspan:"6",class:"text-center pa-6 text-muted"}," No templates found ",-1)])))])]),_:1,__:[27]})]),_:1})]),t(S,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=a=>w.value=a),"max-width":"640",theme:"dark"},{default:o(()=>[t(U,{class:"pa-4"},{default:o(()=>[e[30]||(e[30]=n("h3",null,"Add Template",-1)),t(L,{modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.name=a),label:"Name"},null,8,["modelValue"]),t($,{modelValue:u.value.category,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.category=a),items:["Utility","Marketing","Authentication"],label:"Category"},null,8,["modelValue"]),t($,{modelValue:u.value.language,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.language=a),items:["id","en"],label:"Language"},null,8,["modelValue"]),t(j,{modelValue:u.value.body,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.body=a),label:"Body",rows:"4"},null,8,["modelValue"]),n("div",fe,[t(s,{variant:"text",onClick:e[4]||(e[4]=a=>w.value=!1)},{default:o(()=>e[28]||(e[28]=[r("Cancel")])),_:1,__:[28]}),t(s,{color:"primary",loading:A.value,onClick:O},{default:o(()=>e[29]||(e[29]=[r("Save")])),_:1,__:[29]},8,["loading"])])]),_:1,__:[30]})]),_:1},8,["modelValue"]),t(S,{modelValue:_.value,"onUpdate:modelValue":e[11]||(e[11]=a=>_.value=a),"max-width":"640",theme:"dark"},{default:o(()=>[t(U,{class:"pa-4"},{default:o(()=>[e[33]||(e[33]=n("h3",null,"Edit Template",-1)),t(L,{modelValue:u.value.name,"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.name=a),label:"Name"},null,8,["modelValue"]),t($,{modelValue:u.value.category,"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.category=a),items:["Utility","Marketing","Authentication"],label:"Category"},null,8,["modelValue"]),t($,{modelValue:u.value.language,"onUpdate:modelValue":e[8]||(e[8]=a=>u.value.language=a),items:["id","en"],label:"Language"},null,8,["modelValue"]),t(j,{modelValue:u.value.body,"onUpdate:modelValue":e[9]||(e[9]=a=>u.value.body=a),label:"Body",rows:"4"},null,8,["modelValue"]),n("div",ge,[t(s,{variant:"text",onClick:e[10]||(e[10]=a=>_.value=!1)},{default:o(()=>e[31]||(e[31]=[r("Cancel")])),_:1,__:[31]}),t(s,{color:"primary",loading:A.value,onClick:O},{default:o(()=>e[32]||(e[32]=[r("Update")])),_:1,__:[32]},8,["loading"])])]),_:1,__:[33]})]),_:1},8,["modelValue"]),t(S,{modelValue:y.value,"onUpdate:modelValue":e[16]||(e[16]=a=>y.value=a),"max-width":"720",theme:"dark"},{default:o(()=>[t(U,{class:"pa-4"},{default:o(()=>{var a,b,E,F,I,P,R;return[n("h3",null,f((a=d.value)==null?void 0:a.name),1),n("p",ye,f((b=d.value)==null?void 0:b.category),1),t(D,{class:"mb-3",color:M((E=d.value)==null?void 0:E.status)},{default:o(()=>{var C;return[r(f((C=d.value)==null?void 0:C.status),1)]}),_:1},8,["color"]),n("div",Ve,f((F=d.value)==null?void 0:F.body),1),n("div",be,[((I=d.value)==null?void 0:I.status)==="draft"?(k(),B(s,{key:0,onClick:e[12]||(e[12]=C=>H(d.value.id))},{default:o(()=>e[34]||(e[34]=[r("Submit")])),_:1,__:[34]})):N("",!0),((P=d.value)==null?void 0:P.status)==="submitted"?(k(),B(s,{key:1,color:"green",onClick:e[13]||(e[13]=C=>Q(d.value.id))},{default:o(()=>e[35]||(e[35]=[r("Approve")])),_:1,__:[35]})):N("",!0),((R=d.value)==null?void 0:R.status)==="submitted"?(k(),B(s,{key:2,color:"red",onClick:e[14]||(e[14]=C=>X(d.value.id))},{default:o(()=>e[36]||(e[36]=[r("Reject")])),_:1,__:[36]})):N("",!0),t(s,{variant:"text",onClick:e[15]||(e[15]=C=>y.value=!1)},{default:o(()=>e[37]||(e[37]=[r("Close")])),_:1,__:[37]})])]}),_:1})]),_:1},8,["modelValue"]),t(S,{modelValue:x.value,"onUpdate:modelValue":e[21]||(e[21]=a=>x.value=a),"max-width":"600",theme:"dark"},{default:o(()=>[t(U,{class:"pa-4"},{default:o(()=>[e[40]||(e[40]=n("h3",null,"Send Template",-1)),t(L,{modelValue:i.value.to,"onUpdate:modelValue":e[17]||(e[17]=a=>i.value.to=a),label:"Phone"},null,8,["modelValue"]),t($,{modelValue:i.value.language,"onUpdate:modelValue":e[18]||(e[18]=a=>i.value.language=a),items:["id","en"],label:"Language"},null,8,["modelValue"]),t(j,{modelValue:i.value.componentsJson,"onUpdate:modelValue":e[19]||(e[19]=a=>i.value.componentsJson=a),label:"Components JSON",rows:"4"},null,8,["modelValue"]),n("div",ke,[t(s,{variant:"text",onClick:e[20]||(e[20]=a=>x.value=!1)},{default:o(()=>e[38]||(e[38]=[r("Cancel")])),_:1,__:[38]}),t(s,{color:"primary",loading:m.value,onClick:le},{default:o(()=>e[39]||(e[39]=[r("Send")])),_:1,__:[39]},8,["loading"])])]),_:1,__:[40]})]),_:1},8,["modelValue"])]),_:1})],64)}}},Ue=de(ce,[["__scopeId","data-v-c5774a1a"]]);export{Ue as default};
