import{A as le}from"./AdminLayout-B9id1OaC.js";import{a as re,r as w,c as g,m as ne,b as m,d as p,o as n,e as l,u as O,g as ue,w as o,h as r,t as u,i as v,k as $,f as x,F as C,j,l as _}from"./app-CsZa9FYx.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"template-detail-dark"},ce={class:"text-h6 mb-2"},pe={class:"text-muted"},ve={class:"d-flex gap-2 mt-4"},me={class:"text-muted text-caption"},_e={class:"wa-preview"},fe={class:"wa-bubble"},be={key:0,class:"wa-header"},we={class:"wa-body"},ye={key:1,class:"wa-footer"},ke={class:"text-muted text-caption"},xe={class:"d-flex justify-end mt-3"},Ve={__name:"Show",setup(he){var E,L,U,z,H;const V=re(),t=w(V.props.template??null),B=w(V.props.versions??[]),F=w(V.props.notes??[]),Q=((E=V.props.auth)==null?void 0:E.user)??null,i=w({header:((L=t.value)==null?void 0:L.header)??"",body:((U=t.value)==null?void 0:U.body)??"",footer:((z=t.value)==null?void 0:z.footer)??"",buttons:((H=t.value)==null?void 0:H.buttons)??[]}),h=w({});function A(a){if(!a)return[];const e=a.match(/\{(\d+)\}/g);return e?[...new Set(e.map(b=>b.replace(/[{}]/g,"")))]:[]}const S=g(()=>{const a=new Set([...A(i.value.header),...A(i.value.body),...A(i.value.footer)]);return Array.from(a)});function N(a){if(!a)return"";let e=a;return S.value.forEach(b=>{const d=`{${b}}`;e=e.replaceAll(d,h.value[b]??d)}),e}const R=g(()=>N(i.value.header)),W=g(()=>N(i.value.body)),D=g(()=>N(i.value.footer));async function f(){try{const a=await _.get(`/templates/${t.value.id}`);t.value=a.data.template,B.value=a.data.versions??[],F.value=a.data.notes??[],i.value={header:t.value.header,body:t.value.body,footer:t.value.footer,buttons:t.value.buttons??[]}}catch{alert("Failed to refresh")}}async function X(){await _.post(`/templates/${t.value.id}/versions`,i.value),await f(),alert("Version saved")}async function Y(a){confirm("Revert to this version?")&&(await _.post(`/templates/${t.value.id}/versions/${a}/revert`),await f())}async function Z(){confirm("Submit for approval?")&&(await _.post(`/templates/${t.value.id}/submit`),await f())}async function ee(){const a=prompt("Approval note:");await _.post(`/templates/${t.value.id}/approve`,{note:a}),await f()}async function te(){const a=prompt("Reason for rejection:");a&&(await _.post(`/templates/${t.value.id}/reject`,{reason:a}),await f())}const y=w("");async function ae(){y.value&&(await _.post(`/templates/${t.value.id}/notes`,{note:y.value}),y.value="",await f())}return ne(()=>{S.value.forEach(a=>h.value[a]="")}),(a,e)=>{const b=m("v-chip"),d=m("v-btn"),k=m("v-card"),oe=m("v-text-field"),T=m("v-col"),I=m("v-row"),se=m("v-textarea");return n(),p(C,null,[l(O(ue),{title:"Template Detail"}),l(le,null,{title:o(()=>e[1]||(e[1]=[v(" Template Detail ")])),default:o(()=>[r("div",ie,[l(I,null,{default:o(()=>[l(T,{cols:"12",md:"6"},{default:o(()=>[l(k,{class:"dark-card pa-5 mb-4"},{default:o(()=>{var s,c,M,P,q,G,J;return[r("h3",ce,u((s=t.value)==null?void 0:s.name),1),r("p",pe,u((c=t.value)==null?void 0:c.category)+" · "+u((M=t.value)==null?void 0:M.language),1),l(b,{class:"mt-2",color:"blue-darken-2"},{default:o(()=>{var K;return[v(u((K=t.value)==null?void 0:K.status),1)]}),_:1}),r("div",ve,[l(d,{color:"primary",onClick:X},{default:o(()=>e[2]||(e[2]=[v(" Save Version ")])),_:1,__:[2]}),((P=t.value)==null?void 0:P.status)==="draft"?(n(),$(d,{key:0,color:"blue",onClick:Z},{default:o(()=>e[3]||(e[3]=[v(" Submit ")])),_:1,__:[3]})):x("",!0),((q=O(Q))==null?void 0:q.role)==="superadmin"&&((G=t.value)==null?void 0:G.status)==="submitted"?(n(),$(d,{key:1,color:"green",onClick:ee},{default:o(()=>e[4]||(e[4]=[v(" Approve ")])),_:1,__:[4]})):x("",!0),((J=t.value)==null?void 0:J.status)==="submitted"?(n(),$(d,{key:2,color:"red",onClick:te},{default:o(()=>e[5]||(e[5]=[v(" Reject ")])),_:1,__:[5]})):x("",!0)])]}),_:1}),l(k,{class:"dark-card pa-5 mb-4"},{default:o(()=>[e[6]||(e[6]=r("h4",{class:"text-subtitle-1 mb-3"},"Variables",-1)),l(I,null,{default:o(()=>[(n(!0),p(C,null,j(S.value,s=>(n(),$(T,{key:s,cols:"12",md:"6"},{default:o(()=>[l(oe,{modelValue:h.value[s],"onUpdate:modelValue":c=>h.value[s]=c,label:`Value for {${s}}`,density:"compact"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024))),128))]),_:1})]),_:1,__:[6]}),l(k,{class:"dark-card pa-5"},{default:o(()=>[e[8]||(e[8]=r("h4",{class:"text-subtitle-1 mb-3"},"Versions",-1)),(n(!0),p(C,null,j(B.value,s=>(n(),p("div",{key:s.id,class:"version-row"},[r("div",null,[r("strong",null,"#"+u(s.id),1),r("span",me," · "+u(s.created_at),1)]),l(d,{size:"small",variant:"text",onClick:c=>Y(s.id)},{default:o(()=>e[7]||(e[7]=[v(" Revert ")])),_:2,__:[7]},1032,["onClick"])]))),128))]),_:1,__:[8]})]),_:1}),l(T,{cols:"12",md:"6"},{default:o(()=>[l(k,{class:"dark-card pa-5 mb-4"},{default:o(()=>[e[9]||(e[9]=r("h4",{class:"text-subtitle-1 mb-3"},"Live Preview",-1)),r("div",_e,[r("div",fe,[R.value?(n(),p("p",be,u(R.value),1)):x("",!0),r("p",we,u(W.value),1),D.value?(n(),p("p",ye,u(D.value),1)):x("",!0)])])]),_:1,__:[9]}),l(k,{class:"dark-card pa-5"},{default:o(()=>[e[11]||(e[11]=r("h4",{class:"text-subtitle-1 mb-3"},"Notes",-1)),(n(!0),p(C,null,j(F.value,s=>{var c;return n(),p("div",{key:s.id,class:"note-item"},[r("strong",null,u((c=s.user)==null?void 0:c.name),1),r("p",ke,u(s.note),1)])}),128)),l(se,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),label:"Add note",rows:"2"},null,8,["modelValue"]),r("div",xe,[l(d,{color:"primary",onClick:ae},{default:o(()=>e[10]||(e[10]=[v(" Add Note ")])),_:1,__:[10]})])]),_:1,__:[11]})]),_:1})]),_:1})])]),_:1})],64)}}},Ae=de(Ve,[["__scopeId","data-v-26fc2524"]]);export{Ae as default};
